__d(function(e,t,r,n){function i(e){return e.id}var o=t(379),s=babelHelpers.interopRequireDefault(o),a=t(412),d=babelHelpers.interopRequireDefault(a),l=t(271),p=babelHelpers.interopRequireDefault(l),u=t(44),h=t(790),c=t(654),f=t(1605),b=t(2279),g=babelHelpers.interopRequireDefault(b),y=t(2281),m=babelHelpers.interopRequireDefault(y),R=t(759),w=babelHelpers.interopRequireDefault(R),S=t(841),v=babelHelpers.interopRequireDefault(S),H=t(2225),C=t(422),I=babelHelpers.interopRequireDefault(C),T=t(2232),q=babelHelpers.interopRequireWildcard(T),x=t(2283),D=babelHelpers.interopRequireDefault(x),V=t(2285),E=babelHelpers.interopRequireDefault(V),j=t(2286),A=babelHelpers.interopRequireDefault(j),M=t(2284),O={type:d.default.string.isRequired,id:d.default.oneOfType([d.default.number,d.default.string]).isRequired,selector:d.default.func.isRequired,showInputBar:d.default.bool,shouldLoadOlderItems:d.default.bool.isRequired,listViewHeader:d.default.func.isRequired,listViewFooter:d.default.func.isRequired,thread:d.default.object,store:d.default.object,viewer:d.default.object,sendMessage:d.default.func.isRequired,initializeThread:d.default.func.isRequired,unmountThread:d.default.func.isRequired,updateLastSeen:d.default.func.isRequired,fetchOlderItems:d.default.func.isRequired},z={showInputBar:!0},L=(0,f.memoize)(function(e,t){return new H.Thread({id:e,type:t})}),F=function(e,t){var r=t.id,n=t.type,i=t.selector,o=i(e);return{thread:o.getThread(n,r)||L(r,n),viewer:o.getViewer(n),store:o}},W=function(e){return(0,c.bindActionCreators)(babelHelpers.extends({},(0,w.default)(q,["sendMessage","updateLastSeen","initializeThread","unmountThread","fetchOlderItems"])),e)},k=function(e){function t(r){babelHelpers.classCallCheck(this,t);var n=babelHelpers.possibleConstructorReturn(this,e.call(this,r));return n.renderScrollComponent=n.renderScrollComponent.bind(n),n.renderRow=n.renderRow.bind(n),n.renderHeader=n.renderHeader.bind(n),n.renderFooter=n.renderFooter.bind(n),n.onChangeVisibleRows=n.onChangeVisibleRows.bind(n),n.onEndReached=n.onEndReached.bind(n),n.onMessageSend=n.onMessageSend.bind(n),n.throttledVisibilityUpdate=(0,m.default)(n.throttledVisibilityUpdate.bind(n),200),n.onScroll=n.onScroll.bind(n),n.lastSeenCache={},n.state={ds:(new A.default.DataSource).cloneWithList(r.thread.items)},n}return babelHelpers.inherits(t,e),t.prototype.shouldComponentUpdate=function(e){return this.props.thread!==e.thread},t.prototype.renderScrollComponent=function(e){return p.default.createElement(g.default,babelHelpers.extends({},e,{inverted:!0}))},t.prototype.renderRow=function(e,t,r){var n=this.props,i=n.viewer,o=n.store,s=n.thread;return babelHelpers.jsx(D.default,{item:e,next:t,prev:r,sender:e.sender||o.getParticipant(s.type,e.senderID),viewer:i,thread:s})},t.prototype.renderHeader=function(){var e=this.props,t=e.listViewHeader,r=e.store,n=e.type,i=e.id;return t(r.getThread(n,i))},t.prototype.renderFooter=function(){var e=this.props,t=e.listViewFooter,r=e.store,n=e.type,i=e.id;return t(r.getThread(n,i))},t.prototype.onChangeVisibleRows=function(e){var t=this,r=Date.now();Object.keys(e).forEach(function(e){t.lastSeenCache[e]=r}),this.throttledVisibilityUpdate()},t.prototype.throttledVisibilityUpdate=function(){var e=this;!this.waiting&&this.mounted&&(this.waiting=!0,u.InteractionManager.runAfterInteractions(function(){if(e.waiting=!1,e.mounted){var t=e.lastSeenCache;e.lastSeenCache={},e.props.updateLastSeen(e.props.type,e.props.id,t)}}))},t.prototype.onEndReached=function(){},t.prototype.componentDidMount=function(){this.mounted=!0,this.props.initializeThread(this.props.type,this.props.id)},t.prototype.componentWillReceiveProps=function(e){var t=e.thread.items,r=this.props.thread.items;if(t!==r){if(t.size!==r.size&&t.last()!==r.last()){u.LayoutAnimation.configureNext(u.LayoutAnimation.Presets.easeInEaseOut);var n=t.map(function(e){return e.id}).reduce(function(e,t){var r=e;return r[t]=0,r},{});this.onChangeVisibleRows(n)}this.setState({ds:this.state.ds.cloneWithList(e.thread.items.reverse())})}},t.prototype.componentWillUnmount=function(){this.mounted=!1,this.props.unmountThread(this.props.type,this.props.id)},t.prototype.onMessageSend=function(e,t){this.props.sendMessage(this.props.type,this.props.id,e,t)},t.prototype.renderLoadingIndicator=function(e){return e?babelHelpers.jsx(u.View,{style:P.loaderStyle},void 0,babelHelpers.jsx(v.default,{})):babelHelpers.jsx(u.View,{Style:P.loaderStyleHidden})},t.prototype.renderInternetConnectionStatusMessage=function(e){var t=s.default.phrase("It looks like you\u2019re offline. Please connect to the internet to view this conversation.",null,"A message to display in messaging thread when the internet is not working.");return e?babelHelpers.jsx(u.View,{style:P.internetConnectionError},void 0,babelHelpers.jsx(u.Text,{style:P.internetConnectionErrorText},void 0,t)):null},t.prototype.onScroll=function(e){var t=this.props,r=t.type,n=t.id,i=t.fetchOlderItems,o=t.store,s=t.shouldLoadOlderItems,a=o.getThread(r,n),d=a&&a.olderItemsAvailable,l=a&&a.isFetchingOlderItems,p=u.Dimensions.get("window").height,h=e.nativeEvent.contentSize.height,c=e.nativeEvent.contentOffset.y,f=p+c>=h;s&&f&&d&&!l&&i(a.type,a.id)},t.prototype.render=function(){var e=this.props,t=e.thread,r=e.id,n=e.type,o=e.viewer,a=e.showInputBar,d=e.store,l=this.state.ds,p=d.getThread(n,r),h=!p||p.get("isInitializing"),c=!!p&&!!p.get("data")&&"closed"===p.get("data").status,f=s.default.phrase("Write message...",null,"Write a message in the text input field"),b=p&&p.get("initializeError"),g=a&&!b;return babelHelpers.jsx(u.View,{style:P.container},void 0,this.renderLoadingIndicator(h),this.renderInternetConnectionStatusMessage(b),babelHelpers.jsx(A.default,{keyboardShouldPersistTaps:"always",automaticallyAdjustContentInsets:!1,initialListSize:20,pageSize:20,dataSource:l,renderRow:this.renderRow,renderFooter:this.renderHeader,renderHeader:this.renderFooter,getRowId:i,renderScrollComponent:this.renderScrollComponent,onChangeVisibleRows:this.onChangeVisibleRows,onEndReached:this.onEndReached,onEndReachedThreshold:500,scrollRenderAheadDistance:400,keyboardDismissMode:"on-drag",onScroll:this.onScroll,contentInset:{bottom:10,top:0}}),!c&&g&&!h&&babelHelpers.jsx(E.default,{multiline:!0,submitOnReturn:!1,thread:t,threadId:r,threadType:n,viewer:o,onMessageSend:this.onMessageSend,placeholder:f}))},t}(p.default.Component);k.propTypes=O,k.defaultProps=z;var P=I.default.create(function(e){var t=e.bp,r=e.font;return{container:{overflow:"hidden",flex:1,paddingTop:7*t+M.FIRST_MESSAGE_TO_NAVIGATION_BAR_PADDING},threadContainer:{flex:1},loaderStyle:{paddingTop:150},loaderStyleHidden:{paddingTop:150,opacity:0},internetConnectionError:{alignItems:"center",justifyContent:"center"},internetConnectionErrorText:babelHelpers.extends({},r.footerSubtitle,{textAlign:"center",fontSize:14,color:"#939393",margin:20,lineHeight:18,maxWidth:300})}});r.exports=(0,h.connect)(F,W)(k)},2278);