__d(function(e,t,r,i){function n(e){var t=e.endsAt,r=e.startsAt,i=e.timezone,n=e.titlePast,o=e.titleFuture,a=(0,I.getDatesMetadata)(r,t,i),l=(0,I.getDate)(r,i),s=(0,x.smartRangeFormat)(r,t,i,{allDay:!0}),d=void 0,p=e.title;return a.isUpcoming?(d=(0,I.capitalize)(l.fromNow()),p=o):a.isPast&&(d=(0,I.capitalize)(l.fromNow()),p=n),{suptitlePrefix:d,suptitle:s,title:p}}Object.defineProperty(i,"__esModule",{value:!0});var o=t(379),a=babelHelpers.interopRequireDefault(o),l=t(1023),s=t(412),d=babelHelpers.interopRequireDefault(s),p=t(271),c=babelHelpers.interopRequireDefault(p),u=t(44),f=t(790),h=t(654),b=t(841),v=babelHelpers.interopRequireDefault(b),m=t(410),g=babelHelpers.interopRequireDefault(m),y=t(1412),S=babelHelpers.interopRequireDefault(y),T=t(899),H=babelHelpers.interopRequireDefault(T),D=t(708),R=babelHelpers.interopRequireDefault(D),w=t(1922),C=t(1930),E=t(1818),x=t(1938),I=t(1937),A=t(1477),P=babelHelpers.interopRequireDefault(A),L=t(1946),O=t(1936),_=t(1950),V=babelHelpers.interopRequireDefault(_),M=t(1952),N=babelHelpers.interopRequireDefault(M),j=t(1958),q=babelHelpers.interopRequireDefault(j),F=t(1960),B=babelHelpers.interopRequireDefault(F),z=t(1961),U=babelHelpers.interopRequireDefault(z),Y=t(1963),G="android"===u.Platform.OS,k=function(e){function t(r,i){babelHelpers.classCallCheck(this,t);var n=babelHelpers.possibleConstructorReturn(this,e.call(this,r,i));n.fetchData=n.fetchData.bind(n),n.onChangeAppState=n.onChangeAppState.bind(n),n.onEndReached=n.onEndReached.bind(n),n.onLayoutRow=n.onLayoutRow.bind(n),n.onLayoutPendingHeader=n.onLayoutPendingHeader.bind(n),n.renderHeader=n.renderHeader.bind(n),n.renderFooter=n.renderFooter.bind(n),n.renderRow=n.renderRow.bind(n),n.setListView=n.setListView.bind(n),n.onMomentumScrollEnd=n.onMomentumScrollEnd.bind(n);var o=new u.ListView.DataSource({rowHasChanged:function(e,t){return e!==t}});return n.state={dataSource:n.getDatasource(o,r.tripSchedules),listViewOffset:0},n.hasScrolledOnce=!1,n}return babelHelpers.inherits(t,e),t.prototype.componentDidMount=function(){var e=this.props.verificationCode;e&&this.acceptTripInvite(e),this.fetchData(),u.AppState.addEventListener("change",this.onChangeAppState),R.default.emitter.addListener(R.default.EXPERIENCE_BOOKED,this.fetchData),R.default.emitter.addListener(R.default.RESTAURANT_BOOKED,this.fetchData),R.default.emitter.addListener(R.default.RESERVATION_UPDATED,this.fetchData)},t.prototype.componentWillUnmount=function(){u.AppState.removeEventListener("change",this.onChangeAppState),R.default.emitter.removeListener(R.default.EXPERIENCE_BOOKED,this.fetchData),R.default.emitter.removeListener(R.default.RESTAURANT_BOOKED,this.fetchData),R.default.emitter.removeListener(R.default.RESERVATION_UPDATED,this.fetchData)},t.prototype.componentWillReceiveProps=function(e){var t=e.verificationCode;this.props.tripSchedules!==e.tripSchedules&&this.setState({dataSource:this.getDatasource(this.state.dataSource,e.tripSchedules)}),t&&this.props.verificationCode!==t&&this.acceptTripInvite(t)},t.prototype.acceptTripInvite=function(e){this.canAcceptTripInvite(e)&&this.props.acceptTripInvite(e)},t.prototype.canAcceptTripInvite=function(e){return-1===this.props.acceptedTripInvites.indexOf(e)},t.prototype.fetchData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.props.isLoading||(this.props.fetchTripsSummary(E.SECTION_PENDING,e),this.props.fetchTripsSummary(E.SECTION_UPCOMING_AND_PAST,e))},t.prototype.setListView=function(e){this.listView=e},t.prototype.onChangeAppState=function(e){"active"===e?(this.props.rehydrate(),(0,I.shouldFetch)(this.props.lastSyncedAt)&&this.fetchData({sync:!0})):this.props.cacheData()},t.prototype.onEndReached=function(){var e=this.props,t=e.canFetchMore,r=e.isLoadingMore;t&&!r&&this.props.fetchMore(E.SECTION_UPCOMING_AND_PAST)},t.prototype.onMomentumScrollEnd=function(e){var t=e.nativeEvent.contentOffset.y,r=void 0!==this.prevY&&t<this.prevY;this.prevY=t,(0,Y.logScrollOverviewEvent)(this.props.tripSchedules.length,r)},t.prototype.getDatasource=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.cloneWithRows(t.concat().sort(function(e,t){return(0,L.compareDataForSection)(E.SECTION_UPCOMING_AND_PAST,e,t)}))},t.prototype.renderHeader=function(){var e=l.ThemedStyleSheet.theme,t=e.color,r=e.size;return babelHelpers.jsx(u.View,{style:K.sectionHeaderContainer},void 0,babelHelpers.jsx(N.default,{color:G?t.divider:[t.divider,t.white],height:r.vertical.huge}))},t.prototype.renderFooter=function(){var e=this.props.tripSchedules;return babelHelpers.jsx(N.default,{color:(0,I.getTimelineColorForIndex)(e.length,{gray:0===e.length}).reverse(),height:400,type:N.default.Timeline.TYPE_LINE})},t.prototype.onLayoutRow=function(e){var t=e.nativeEvent;if(!this.hasScrolledOnce){var r=t.layout,i=r.y,n=r.height;this.listView.scrollTo({y:i-n,animated:!0}),this.hasScrolledOnce=!0}},t.prototype.onLayoutPendingHeader=function(e){var t=e.nativeEvent,r=t.layout.height;this.setState({listViewOffset:r})},t.prototype.renderRow=function(e,t,r){var i=this,o=e.confirmationCode,a=e.endsAt,l=e.pictures,s=e.startsAt,d=e.timezone,p=this.props.tripSchedules,c=n(e),f=(0,I.getDatesMetadata)(s,a,d),h=f.isHappening,b=f.isPast,v=f.isUpcoming,m=(0,I.getTimelineColorForIndex)(parseInt(r,10)+1,{gray:!b}).reverse(),g=(0,I.getTimelineColorForIndex)(parseInt(r,10)+1).reverse();return babelHelpers.jsx(u.View,{style:K.tripRowContainer,onLayout:h?this.onLayoutRow:null},void 0,babelHelpers.jsx(N.default,{color:m,iconColor:v?m[0]:g[0],iconSize:h?"medium":"small",pictures:l,pictureLarge:!1,suptitle:c.suptitle,suptitleSeparator:!!c.suptitlePrefix,suptitlePrefix:c.suptitlePrefix,title:c.title,onPress:function(){return i.props.onPressRow(o)}}),p.length>0&&p.length-1===r&&this.renderLoadMore())},t.prototype.renderLoadMore=function(){var e=this.props,t=e.canFetchMore,r=e.isLoadingMore;return t&&r?babelHelpers.jsx(u.View,{style:K.inlineLoader},void 0,babelHelpers.jsx(v.default,{})):null},t.prototype.renderPendingTitle=function(){var e=this.props,t=e.pendingCount,r=e.verification,i=r.needMtTOS,n=r.needVerification,o=r.isVerificationPending,l=r.soonestExpiresTitle,s=r.soonestBookedAt,d=r.timezone;if(0===t)return null;if(o)return a.default.phrase("We\u2019re still verifying your info.",null,"a title when ID verification is pending");if(i||n){var p=(0,I.getIdentityTimeLeft)(s,d);return n?babelHelpers.jsx(H.default,{default:"%{bold_start}%{time}%{bold_end} left to verify your info for %{experienceName}.",bold:babelHelpers.jsx(u.Text,{style:K.alertBold}),context:"a title for pending items experiences when user needs to verify their ID",time:p,experienceName:l},"needVerification"):babelHelpers.jsx(H.default,{default:"%{bold_start}%{time}%{bold_end} left to agree to our terms for %{experienceName}.",bold:babelHelpers.jsx(u.Text,{style:K.alertBold}),context:"a title for pending experiences when user needs to accept Term of Service",time:p,experienceName:l},"needMtTOS")}return i||n?null:babelHelpers.jsx(H.default,{default:"%{bold_start}%{smart_count}%{bold_end} home pending host approval. |||| %{bold_start}%{smart_count}%{bold_end} homes pending host approval.",bold:babelHelpers.jsx(u.Text,{style:K.boldText}),context:"a title for pending homes",smart_count:t},t+"-pendingHomes")},t.prototype.renderPendingActionTitle=function(){var e=this.props.verification,t=e.isVerificationPending,r=e.pendingCount,i=e.needMtTOS,n=e.needVerification;return 0===r?null:t||!i&&!n?a.default.phrase("View",null,"a button to view pending item (reservations/experiences)"):a.default.phrase("Complete",null,"a button to complete ID verification or accept TOS")},t.prototype.shouldDisplayPendingHeader=function(){var e=this.props,t=e.pendingCount,r=e.verification,i=r.isVerificationPending,n=r.needMtTOS,o=r.needVerification;return i||n||o||t>0},t.prototype.renderPendingHeader=function(){return this.shouldDisplayPendingHeader()?babelHelpers.jsx(u.View,{style:[K.pendingHeader,G&&K.pendingHeaderAndroid],onLayout:this.onLayoutPendingHeader},void 0,babelHelpers.jsx(S.default,{actionInverse:!0,actionSmall:!0,actionTitle:this.renderPendingActionTitle(),divider:"full",onPress:function(){return g.default.present(w.ITINERARY_PENDING)},title:this.renderPendingTitle()})):null},t.prototype.renderContent=function(){var e=this.props,t=e.isLoading,r=e.tripSchedules;return t&&0===r.length?babelHelpers.jsx(u.View,{style:K.fill},void 0,babelHelpers.jsx(v.default,{})):0===r.length?babelHelpers.jsx(u.View,{style:[K.fill,{marginTop:this.state.listViewOffset/2}]},void 0,babelHelpers.jsx(q.default,{})):c.default.createElement(u.ListView,{automaticallyAdjustContentInsets:!1,dataSource:this.state.dataSource,enableEmptySections:!0,initialListSize:10,onEndReached:this.onEndReached,onMomentumScrollEnd:this.onMomentumScrollEnd,ref:this.setListView,renderHeader:this.renderHeader,renderFooter:this.renderFooter,renderRow:this.renderRow,showsVerticalScrollIndicator:!1,style:[K.listView,{marginTop:this.state.listViewOffset}]})},t.prototype.render=function(){return babelHelpers.jsx(V.default,{style:K.container},void 0,babelHelpers.jsx(g.default.Screen,{barType:g.default.Screen.BAR_TYPE.STATIC,onAppear:G?this.fetchData:function(){},title:a.default.phrase("Trips",null,"a navigation title for the Itinerary"),showTabBar:!0}),this.renderContent(),this.renderPendingHeader())},t}(p.Component);k.propTypes={canFetchMore:d.default.bool,isLoadingMore:d.default.bool,isLoading:d.default.bool,lastSyncedAt:d.default.number,pendingCount:d.default.number,sections:d.default.object,tripSchedules:d.default.arrayOf(B.default),verification:U.default,verificationCode:d.default.string,acceptedTripInvites:d.default.array,acceptTripInvite:d.default.func.isRequired,cacheData:d.default.func.isRequired,fetchTripsSummary:d.default.func.isRequired,fetchMore:d.default.func.isRequired,onPressRow:d.default.func.isRequired,rehydrate:d.default.func.isRequired},k.defaultProps={canFetchMore:!1,isLoadingMore:!1,isLoading:!1,lastSyncedAt:null,pendingCount:0,tripSchedules:[],verification:{},verificationCode:null};var K=l.ThemedStyleSheet.create(function(e){var t=e.bp,r=e.color,i=e.font,n=e.size;return{boldText:i.regularBold,alertBold:babelHelpers.extends({},i.regularBold,{color:r.core.babu}),container:{backgroundColor:r.white,flex:1},listView:{position:"absolute",bottom:0,top:-300,left:0,right:0,transform:[{scaleY:-1}]},inlineLoader:{paddingVertical:n.vertical.tiny,marginVertical:n.vertical.tiny},fill:{flex:1},pendingHeader:{backgroundColor:r.white,position:"absolute",left:0,right:0,top:48,flex:1,zIndex:1,paddingTop:n.vertical.small,shadowOffset:{width:0,height:t/4},shadowColor:r.accent.hrGray,shadowOpacity:.6,shadowRadius:t/2},pendingHeaderAndroid:{top:0},sectionHeaderContainer:{backgroundColor:r.white,transform:[{scaleY:-1}]},sectionHeader:i.title2,stretch:{flex:1,minHeight:200},tripRowContainer:{overflow:"hidden",transform:[{scaleY:-1}]},verificationButtonContainer:{flexDirection:"row",marginVertical:n.vertical.medium}}}),W=(0,f.connect)(function(e){return(0,O.rootScreenSelector)(e)},function(e){return{acceptTripInvite:(0,h.bindActionCreators)(C.acceptTripInvite,e),cacheData:(0,h.bindActionCreators)(C.cacheData,e),fetchTripsSummary:(0,h.bindActionCreators)(C.fetchTripsSummary,e),fetchMore:function(t){return e((0,C.fetchTripsSummary)(t,{more:!0}))},onPressRow:function(e){(0,Y.logItineraryEvent)(e),g.default.push(w.ITINERARY_TIMELINE,{confirmationCode:e})},rehydrate:(0,h.bindActionCreators)(C.rehydrate,e)}})(k);i.default=(0,P.default)(C.rehydrate)(W)},1949);