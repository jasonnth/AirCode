__d(function(e,t,r,i){function s(e,t){(0,Be.logPDPClickHost)(e,t),I.default.push(Fe.USER_PROFILE,{user_id:e,hide_reviews:!0})}function l(e,t){if(!e)return null;var r=e.merged_video_collection_multimedia;return r&&r[0]?{videoId:r[0].video.id,videoUri:(0,we.selectPlatformVideoUri)(r[0].video,t)}:null}function o(e,t,r){if(!e)return t?[{uri:t}]:[];var i=e.poster_pictures,s=e.carousel_collection_multimedia,l=[];i&&i.length>0&&l.push({uri:i[0].xl_poster});var o=(s||[]).map(function(e){return e.picture?{uri:e.picture.xl_poster}:e.video&&e.video.is_video_ready?{id:e.video.id,isVideo:!0,uri:(0,we.selectPlatformVideoUri)(e.video,r)}:null}).filter(function(e){return e&&e.uri});return l.concat(o)}Object.defineProperty(i,"__esModule",{value:!0});var a=t(271),n=babelHelpers.interopRequireDefault(a),p=t(834),d=t(44),u=t(790),c=t(654),b=t(782),f=babelHelpers.interopRequireDefault(b),h=t(562),T=babelHelpers.interopRequireDefault(h),m=t(379),v=babelHelpers.interopRequireDefault(m),R=t(1603),S=t(1604),y=t(841),H=babelHelpers.interopRequireDefault(y),g=t(787),w=babelHelpers.interopRequireDefault(g),x=t(1023),D=t(410),I=babelHelpers.interopRequireDefault(D),q=t(778),_=babelHelpers.interopRequireDefault(q),j=t(420),C=babelHelpers.interopRequireDefault(j),F=t(1583),B=babelHelpers.interopRequireDefault(F),E=t(1348),P=babelHelpers.interopRequireDefault(E),k=t(1352),U=babelHelpers.interopRequireDefault(k),O=t(1411),A=babelHelpers.interopRequireDefault(O),W=t(899),V=babelHelpers.interopRequireDefault(W),L=t(839),Y=babelHelpers.interopRequireDefault(L),N=t(789),M=babelHelpers.interopRequireDefault(N),G=t(1573),z=babelHelpers.interopRequireWildcard(G),J=t(1639),K=babelHelpers.interopRequireDefault(J),Q=t(1643),X=babelHelpers.interopRequireDefault(Q),Z=t(1659),$=babelHelpers.interopRequireDefault(Z),ee=t(1669),te=babelHelpers.interopRequireDefault(ee),re=t(1693),ie=babelHelpers.interopRequireDefault(re),se=t(1714),le=babelHelpers.interopRequireDefault(se),oe=t(1678),ae=babelHelpers.interopRequireDefault(oe),ne=t(1679),pe=babelHelpers.interopRequireDefault(ne),de=t(1700),ue=babelHelpers.interopRequireDefault(de),ce=t(1704),be=babelHelpers.interopRequireDefault(ce),fe=t(1670),he=babelHelpers.interopRequireDefault(fe),Te=t(1705),me=babelHelpers.interopRequireDefault(Te),ve=t(1606),Re=babelHelpers.interopRequireDefault(ve),Se=t(1706),ye=babelHelpers.interopRequireDefault(Se),He=t(1575),ge=t(1685),we=t(1709),xe=t(1657),De=t(1680),Ie=t(1684),qe=t(1661),_e=t(1711),je=t(1585),Ce=t(1482),Fe=babelHelpers.interopRequireWildcard(Ce),Be=t(1609),Ee=t(1710),Pe=t(1578),ke=t(1668),Ue=babelHelpers.interopRequireDefault(ke),Oe=t(1634),Ae=babelHelpers.interopRequireDefault(Oe),We={currentTab:p.Types.number,feedbacks:p.Types.array,isFetchingReviews:p.Types.bool,isPreview:p.Types.bool,reviews:p.Types.arrayOf(Ue.default),scheduledTripTemplates:p.Types.array,selectedScheduledTripTemplate:p.Types.object,tripTemplate:p.Types.object,tripTemplateId:p.Types.number.isRequired,loadFutureReservationsSuccess:p.Types.bool.isRequired,futureReservations:p.Types.array.isRequired,mtPdpReferrer:p.Types.number,mtPdpReferrerId:p.Types.number,otherExperience:(0,p.Shape)({title:p.Types.string.isRequired,tripTemplates:p.Types.arrayOf(Ae.default)}),posterImageURL:p.Types.string,searchContextString:p.Types.string,searchStartDate:p.Types.string,searchEndDate:p.Types.string,soundOn:p.Types.bool.isRequired,notWaitlisted:p.Types.bool,loadFeedbacks:p.Types.func.isRequired,loadOtherExperiences:p.Types.func.isRequired,loadReviews:p.Types.func.isRequired,loadScheduledTripTemplates:p.Types.func.isRequired,loadTripTemplate:p.Types.func.isRequired,loadUser:p.Types.func.isRequired,loadWaitlists:p.Types.func.isRequired,loadFutureReservations:p.Types.func.isRequired,setTimeout:p.Types.func.isRequired},Ve={currentTab:R.ExploreSubtab.Unknown,feedbacks:[],isFetchingReviews:!1,isPreview:!1,mtPdpReferrer:S.MtPdpReferrer.Unknown,mtPdpReferrerId:0,otherExperience:{title:"",tripTemplates:[]},reviews:[],posterImageURL:null,scheduledTripTemplates:[],searchContextString:null,searchStartDate:null,searchEndDate:null,selectedScheduledTripTemplate:null,similarTripTemplates:[],notWaitlisted:null},Le=function(e,t){return{feedbacks:(0,Pe.feedbacksSelector)(e,t.tripTemplateId),isFetchingReviews:(0,Pe.rootSelector)(e).get("isFetchingReviews"),otherExperience:(0,Pe.otherExperienceSelector)(e,t.tripTemplateId),reviews:(0,Pe.reviewsSelector)(e,t.tripTemplateId),scheduledTripTemplates:(0,Pe.scheduledTripTemplatesSelector)(e,t.tripTemplateId),selectedScheduledTripTemplate:(0,Pe.rootSelector)(e).get("bookingData").scheduledTripTemplate,tripTemplate:(0,Pe.tripTemplateSelector)(e,t.tripTemplateId),loadFutureReservationsSuccess:(0,Pe.rootSelector)(e).get("loadFutureReservationsSuccess"),futureReservations:(0,Pe.futureReservationsSelector)(e),soundOn:(0,Pe.rootSelector)(e).get("soundOn"),notWaitlisted:(0,Pe.rootSelector)(e).get("showWaitlistsByTripTemplateId").get(t.tripTemplateId)}},Ye=function(e){return(0,c.bindActionCreators)({loadFeedbacks:z.loadFeedbacks,loadFutureReservations:z.loadFutureReservations,loadOtherExperiences:z.loadOtherExperiences,loadReviews:z.loadReviews,loadScheduledTripTemplates:z.loadScheduledTripTemplates,loadTripTemplate:z.loadTripTemplate,loadUser:z.loadUser,loadWaitlists:z.loadWaitlists},e)},Ne=function(e){function t(r){babelHelpers.classCallCheck(this,t);var i=babelHelpers.possibleConstructorReturn(this,e.call(this,r));return i.state={buttonRowBottom:new d.Animated.Value(0),coverFocused:!0,transitionCompleted:!1,shouldRenderBody:!1,showAboutHostOnTop:(0,Ee.inHighlightAboutHostSection)()},i.setScrollScreen=i.setScrollScreen.bind(i),i.onScroll=i.onScroll.bind(i),i.prevOffset=0,i.buttonRowVisible=!1,i.buttonRowFinishedAnimatingIn=!1,i.isTouching=!1,i.props.setTimeout(function(){return i.setState({shouldRenderBody:!0})},500),i}return babelHelpers.inherits(t,e),t.prototype.componentWillMount=function(){this.setState({networkInfo:C.default.networkInfo()})},t.prototype.componentDidMount=function(){var e=this;this.loadTemplate(),this.loadFutureReservationsIfNecessary(),this.props.loadUser("me"),this.props.setTimeout(function(){return e.setState({transitionCompleted:!0})},4e3),(0,Be.logPDPImpressionEvent)(this.props)},t.prototype.componentWillReceiveProps=function(e){var t=e.tripTemplate;this.props.tripTemplate!==t&&this.loadOtherExperiences(t)},t.prototype.loadTemplate=function(){var e=this.props,t=e.loadFeedbacks,r=e.loadReviews,i=e.loadScheduledTripTemplates,s=e.loadTripTemplate,l=e.loadWaitlists,o=e.tripTemplateId;s(o);var a=(0,T.default)(),n=(0,T.default)(a).add("8","months"),p={starts_after:a.format("YYYY-MM-DD"),starts_before:n.format("YYYY-MM-DD"),template_id:o,guest_count:1};t({template_id:o}),r(o),i(p),null===this.props.notWaitlisted&&l({template_id:o})},t.prototype.loadOtherExperiences=function(e){var t=e.id,r=e.market.name,i=this.props,s=i.searchStartDate,l=i.searchEndDate,o=i.loadOtherExperiences,a=s&&l?{checkin:s,checkout:l}:{};o(t,babelHelpers.extends({location:r},a))},t.prototype.loadFutureReservationsIfNecessary=function(){this.props.loadFutureReservationsSuccess||this.props.loadFutureReservations()},t.prototype.slideUpButtonRow=function(){var e=this;this.buttonRowVisible||(d.Animated.timing(this.state.buttonRowBottom,{toValue:-K.default.contentInset.bottom,duration:250}).start(function(t){var r=t.finished;e.buttonRowFinishedAnimatingIn=r}),this.buttonRowVisible=!0)},t.prototype.slideDownButtonRow=function(){this.buttonRowVisible&&(d.Animated.timing(this.state.buttonRowBottom,{toValue:0,duration:250}).start(),this.buttonRowVisible=!1,this.buttonRowFinishedAnimatingIn=!1)},t.prototype.forceSlideUpButtonRowIfNecessary=function(e){this.contentHeight&&e>this.contentHeight-(0,xe.getWindowDimension)().height-200&&2*e>this.contentHeight&&!this.buttonRowFinishedAnimatingIn&&(this.setState({buttonRowBottom:new d.Animated.Value(-K.default.contentInset.bottom)}),this.buttonRowFinishedAnimatingIn=!0)},t.prototype.onScroll=function(e){var t=e.nativeEvent.contentOffset.y,r=t>this.prevOffset;r&&t>300&&this.slideUpButtonRow(),!r&&t<500&&this.slideDownButtonRow(),this.forceSlideUpButtonRowIfNecessary(t),this.prevOffset=t;var i=this.state.coverFocused;i&&t>300&&this.setState({coverFocused:!1}),!i&&t<=300&&this.setState({coverFocused:!0})},t.prototype.scheduledTripTemplateIsUserSelected=function(){var e=this.props,t=e.selectedScheduledTripTemplate,r=e.scheduledTripTemplates;return!(!t||!r.map(function(e){return e.id}).includes(t.id))},t.prototype.filterSelectedTripsBySearchDates=function(){return(0,De.filterScheduledExperiencesByDateRange)(this.props.searchStartDate,this.props.searchEndDate,this.props.scheduledTripTemplates)},t.prototype.getScheduledTripTemplate=function(){var e=this.props,t=e.selectedScheduledTripTemplate,r=e.scheduledTripTemplates;return this.scheduledTripTemplateIsUserSelected()?t:this.filterSelectedTripsBySearchDates()[0]||r[0]},t.prototype.renderHostRow=function(){var e=this.props.tripTemplate,t=e.experience_host_profile.host,r=t.first_name,i=t.id,l=t.profile_pic_path,o=e.is_social_good,a=(0,ge.productHostRowTitle)(e),n=a||(0,De.displayImmersionDurationDays)(e,this.getScheduledTripTemplate(),o);return babelHelpers.jsx(A.default,{divider:"none",imageUrl:l,onPressImage:function(){return s(i,e)},title:n,subtitle:babelHelpers.jsx(V.default,{default:"Hosted by %{link_start}%{firstName}%{link_end}",link:babelHelpers.jsx(d.Text,{style:Me.link,onPress:function(){return s(i,e)}}),firstName:r,context:"Experience host info"})})},t.prototype.renderCover=function(){var e=this.props,t=e.posterImageURL,r=e.soundOn,i=e.tripTemplate,s=e.tripTemplateId,o=this.state.coverFocused,a=l(i,this.state.networkInfo);return babelHelpers.jsx(he.default,{prefetchedUri:t,photos:(0,_e.getCoverPictures)(i,t),tripTemplate:i,tripTemplateId:s,coverFocused:o,videoUri:a?a.videoUri:null,videoId:a?a.videoId:0,soundOn:r})},t.prototype.renderBody=function(){var e=this.props,t=e.selectedScheduledTripTemplate,r=e.scheduledTripTemplates,i=e.tripTemplate,s=e.searchStartDate,l=e.searchEndDate,o=e.notWaitlisted,a=this.state,n=a.shouldRenderBody,p=a.showAboutHostOnTop;if(!n||!i||!r)return babelHelpers.jsx(d.View,{style:Me.bodyLoaderContainer},void 0,babelHelpers.jsx(H.default,{}));var u=i.experiences,c=i.market.name,b=this.getScheduledTripTemplate(),f=!(!s||!l),h=!!(f&&b&&(0,Ie.scheduledTemplateIsBetween)(b,s,l)),T=!t||!b||b.id!==t.id;return babelHelpers.jsx(_.default,{},void 0,babelHelpers.jsx(me.default,{asMarquee:C.default.isTablet&&C.default.isLandscape(),tripTemplate:i}),this.renderHostRow(),babelHelpers.jsx(pe.default,{tripTemplate:i,scheduledTripTemplate:b}),p&&babelHelpers.jsx(te.default,{tripTemplate:i,isSingleExperience:!1}),babelHelpers.jsx(le.default,{searchIsInSpecificRange:f,isSample:T,isWithinSearchedRange:h,experiences:u,scheduledTripTemplate:b,scheduledTripTemplateIsUserSelected:this.scheduledTripTemplateIsUserSelected(),market:c,tripTemplate:i,notWaitlisted:o}),this.renderSectionsBelowItinerary())},t.prototype.renderSectionsBelowItinerary=function(){var e=this.props,t=e.feedbacks,r=e.futureReservations,i=e.isFetchingReviews,s=e.isPreview,l=e.otherExperience,o=l.title,a=l.tripTemplates,n=e.reviews,p=e.scheduledTripTemplates,u=e.tripTemplate,c=this.state.showAboutHostOnTop,b=u.id,f=parseFloat(u.star_rating);return babelHelpers.jsx(d.View,{},void 0,babelHelpers.jsx(X.default,{experiences:u.experiences,futureReservations:r,tripTemplate:u}),babelHelpers.jsx(Re.default,{tripTemplate:u}),!c&&babelHelpers.jsx(te.default,{tripTemplate:u,isSingleExperience:!1}),babelHelpers.jsx(ie.default,{isPreview:s,tripTemplate:u,scheduledTripTemplates:p}),babelHelpers.jsx(ue.default,{isFetching:i,reviews:n,tripTemplate:u,starRating:f}),t&&t.length>0&&(0,qe.extractPhotosFromReviews)(t).length>0&&babelHelpers.jsx($.default,{reviews:t,tripTemplateId:b}),babelHelpers.jsx(ae.default,{tripTemplate:u}),babelHelpers.jsx(be.default,{tripTemplate:u}),a.length>0&&babelHelpers.jsx(ye.default,{similarTripTemplates:a,title:o}))},t.prototype.renderTabletLandscape=function(){var e=this.props,t=e.tripTemplate,r=e.notWaitlisted;return babelHelpers.jsx(d.View,{style:Me.containerTabletLandscape},void 0,babelHelpers.jsx(I.default.Screen,{barType:I.default.Screen.BAR_TYPE.STATIC}),babelHelpers.jsx(d.View,{style:Me.wrapper},void 0,babelHelpers.jsx(w.default,{},void 0,this.renderBody()),t&&babelHelpers.jsx(d.View,{style:[Me.buttonContainer,Me.buttonContainerLandscape]},void 0,babelHelpers.jsx(K.default,{tripTemplate:t,isSoldOut:!this.getScheduledTripTemplate(),notWaitlisted:r})),t&&this.renderWaitlistSaveSuccessToast()),babelHelpers.jsx(d.View,{},void 0,this.renderCover()))},t.prototype.setScrollScreen=function(e){this.scrollScreen=e},t.prototype.renderWaitlistSaveSuccessToast=function(){var e=this.props.tripTemplate,t=e.experience_host_profile.host.first_name;return babelHelpers.jsx(M.default,{},void 0,babelHelpers.jsx(U.default,{id:He.SAVE_WAITLIST_SUCCESS_PDP_TOAST,title:v.default.phrase("Great!",null,"congratulations title"),description:v.default.phrase("You\u2019ll be notified once %{hostName} adds more dates.",{hostName:t},"notification message")}))},t.prototype.renderPortrait=function(){var e=this,t=this.props,r=t.scheduledTripTemplates,i=t.tripTemplate,s=t.tripTemplateId,l=t.isPreview,o=t.notWaitlisted;return babelHelpers.jsx(d.View,{style:Me.container},void 0,babelHelpers.jsx(I.default.Screen,{onEnterTransitionComplete:function(){return e.setState({transitionCompleted:!0})},hideStatusBarUntilFoldOffset:!0}),n.default.createElement(w.default,{ref:this.setScrollScreen,onScroll:this.onScroll,scrollEventThrottle:200,withInsets:[K.default]},babelHelpers.jsx(d.View,{style:Me.mainContent,removeClippedSubviews:!0,onLayout:function(t){var r=t.nativeEvent;e.contentHeight=r.layout.height}},void 0,this.renderCover(),babelHelpers.jsx(P.default,{type:"tripTemplate",typeId:s,subType:"body",subTypeId:0},void 0,this.renderBody()))),i&&r&&this.state.transitionCompleted&&babelHelpers.jsx(d.Animated.View,{style:[Me.buttonContainer,{transform:[{translateY:this.state.buttonRowBottom}]}]},void 0,babelHelpers.jsx(K.default,{tripTemplate:i,isSoldOut:!this.getScheduledTripTemplate(),isPreview:l,notWaitlisted:o})),i&&this.renderWaitlistSaveSuccessToast())},t.prototype.render=function(){var e=this;return 0===o(this.props.tripTemplate,this.props.posterImageURL,this.state.networkInfo).length?babelHelpers.jsx(d.View,{style:[Me.container,Me.loadingContainer]},void 0,babelHelpers.jsx(I.default.Screen,{barType:I.default.Screen.BAR_TYPE.BASIC,hideStatusBarUntilFoldOffset:!0}),babelHelpers.jsx(H.default,{})):babelHelpers.jsx(B.default,{renderPortrait:function(){return e.renderPortrait()},renderLandscape:function(){return e.renderTabletLandscape()},onLayoutChange:function(){e.state.hasRotated||e.setState({hasRotated:!0})}})},t}(n.default.Component),Me=x.ThemedStyleSheet.create(function(e){var t=e.bp,r=e.color,i=e.font;return{bodyLoaderContainer:{paddingTop:4*t,paddingBottom:8*t,backgroundColor:r.white},buttonContainer:babelHelpers.extends({position:"absolute",bottom:-K.default.contentInset.bottom-2,left:-1,right:-1},Y.default.footer,{paddingLeft:1,paddingRight:1}),buttonContainerLandscape:{bottom:0},container:{flex:1,backgroundColor:r.white},containerTabletLandscape:{flex:1,flexDirection:"row",backgroundColor:r.white,marginTop:je.TABLET_LANDSCAPE_PADDING_TOP},coverImage:{backgroundColor:r.coverImageBackground},loadingContainer:{alignItems:"center",marginTop:8*t},mainContent:{marginBottom:-3},wrapper:{flex:1,paddingBottom:K.default.contentInset.bottom,marginBottom:-3},link:i.regularActionable}});Ne.propTypes=We,Ne.defaultProps=Ve,i.default=(0,u.connect)(Le,Ye)((0,f.default)(Ne))},1713);