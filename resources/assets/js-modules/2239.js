__d(function(t,e,n,r){function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0}),r.NEWEST_FIRST=r.OLDEST_FIRST=void 0;var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=e(417),c=e(2235),f=function(t){return t&&t.__esModule?t:{default:t}}(c),d=function(t){return""+String(t)},l=function(t,e){return String(t)+"$"+String(d(e))},h=function(t,e){return String(t)+"$"+String(d(e))},p=function(t){return""+String(t)},v="participantsByID",y="threadsByID",g="viewerByThreadType",m=r.OLDEST_FIRST={sortMapper:function(){function t(t){return t.timestamp}return t}(),oldestFirst:!0},I=(r.NEWEST_FIRST={sortMapper:function(){function t(t){return-t.timestamp}return t}(),oldestFirst:!1},(0,s.Record)({participantsByID:(0,s.Map)(),threadsByID:(0,s.Map)(),viewerByThreadType:(0,s.Map)(),options:{}})),T=function(t){function e(){return u(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),a(e,[{key:"getOptions",value:function(){function t(){return this.options||{}}return t}()},{key:"getThread",value:function(){function t(t,e){return this.getIn([y,h(t,e)])}return t}()},{key:"getItem",value:function(){function t(t,e,n){var r=this.getThread(t,e);if(r)return r.getItem(n)}return t}()},{key:"getNewestItem",value:function(){function t(t,e){var n=this.getThread(t,e);return n&&n.items&&n.items.size?this.getSortOrder().oldestFirst?n.items.last():n.items.first():null}return t}()},{key:"getOldestItem",value:function(){function t(t,e){var n=this.getThread(t,e);return n&&n.items&&n.items.size?this.getSortOrder().oldestFirst?n.items.first():n.items.last():null}return t}()},{key:"getParticipant",value:function(){function t(t,e){return this.getIn([v,l(t,e)])}return t}()},{key:"getViewer",value:function(){function t(t){return this.getParticipant(t,this.getViewerID(t))}return t}()},{key:"getViewerID",value:function(){function t(t){return this.getIn([g,p(t)])}return t}()},{key:"getSortOrder",value:function(){function t(){return this.getOptions().sortOrder||m}return t}()},{key:"getSortMapper",value:function(){function t(){return this.getSortOrder().sortMapper}return t}()},{key:"applyPayload",value:function(){function t(t,e,n){var r=this;return!n||n.isEmpty()?this:this.withMutations(function(u){if(n.hasParticipantsToUpsert()){var i=n.participantsToUpsert;u.set(v,r[v].withMutations(function(e){i.forEach(function(n){var r=l(t,n.id),u=e.get(r);e.set(r,u?n.mergeOver(e.get(r)):n)})}))}null!==n.viewerID&&u.set(g,r[g].set(p(t),n.viewerID));var o=r.getThread(t,e),a=o||new f.default({type:t,id:e});(a=a.applyPayload(n,r.getSortOrder()))!==o&&u.set(y,r[y].set(h(t,e),a))})}return t}()},{key:"updateThread",value:function(){function t(t,e,n){return this.updateIn([y,h(t,e)],n)}return t}()},{key:"setOlderItemsAvailable",value:function(){function t(t,e,n){return void 0===n?this:this.updateThread(t,e,function(t){return t.set("olderItemsAvailable",n)})}return t}()},{key:"updateItem",value:function(){function t(t,e,n,r){return this.updateThread(t,e,function(t){return t.updateItem(n,r)})}return t}()},{key:"setSendStatus",value:function(){function t(t,e,n,r){return this.updateItem(t,e,n,function(t){return t.set("sendStatus",r)})}return t}()},{key:"setReadStatus",value:function(){function t(t,e,n,r){return this.updateItem(t,e,n,function(t){return t.set("readStatus",r)})}return t}()},{key:"setActiveStatus",value:function(){function t(t,e,n){return this.updateThread(t,e,function(t){return t.set("isMounted",n)})}return t}()},{key:"bulkUpdateLastSeenForItems",value:function(){function t(t,e,n){var r=this;return this.updateIn([y,h(t,e)],function(e){return e.bulkUpdateLastSeenForItems(n,r.getViewerID(t))})}return t}()},{key:"insertItemToThread",value:function(){function t(t,e,n){var r=this;return n?this.updateThread(t,e,function(t){return t.insertItemNearFront(n,r.getSortMapper())}):this}return t}()},{key:"bulkInsertItemsToThread",value:function(){function t(t,e,n){var r=this;return n?this.updateThread(t,e,function(t){var e=t;return n.forEach(function(t){e=e.insertItemNearFront(t,r.getSortMapper())}),e}):this}return t}()},{key:"removeItemFromThread",value:function(){function t(t,e,n){var r=d(n);return this.updateThread(t,e,function(t){return t.update("items",function(t){return t.delete(t.findIndex(function(t){return t.id===r}))})})}return t}()},{key:"bulkRemoveItemsFromThread",value:function(){function t(t,e,n){var r=new s.Set(n);return this.updateThread(t,e,function(t){return t.update("items",function(t){return t.filter(function(t){return!r.has(t.id)})})})}return t}()},{key:"addThread",value:function(){function t(t){var e=h(t.type,t.id);return this.setIn([y,e],t)}return t}()},{key:"updateThreadMeta",value:function(){function t(t,e,n){return this.updateThread(t,e,function(t){return t.mergeMeta(n)})}return t}()},{key:"doneInitializing",value:function(){function t(t,e,n){return this.updateThread(t,e,function(t){return t.set("isInitializing",!1).set("initializeError",n||null)})}return t}()},{key:"startedFetchingNewerItems",value:function(){function t(t,e){return this.updateThread(t,e,function(t){return t.set("isFetchingNewerItems",!0)})}return t}()},{key:"doneFetchingNewerItems",value:function(){function t(t,e,n){return this.updateThread(t,e,function(t){return t.set("isFetchingNewerItems",!1).set("newerItemsError",n||null)})}return t}()},{key:"startedFetchingOlderItems",value:function(){function t(t,e){return this.updateThread(t,e,function(t){return t.set("isFetchingOlderItems",!0)})}return t}()},{key:"doneFetchingOlderItems",value:function(){function t(t,e,n){return this.updateThread(t,e,function(t){return t.set("isFetchingOlderItems",!1).set("olderItemsError",n||null)})}return t}()},{key:"doneUpdatingLastSeen",value:function(){function t(t,e,n){return this.updateThread(t,e,function(t){return t.set("updateLastSeenError",n||null)})}return t}()},{key:"addParticipant",value:function(){function t(t,e){if(!e)return this;var n=this.getParticipant(t,e.id);return n?this.setIn([v,l(t,e.id)],e.mergeOver(n)):this.setIn([v,l(t,e.id)],e)}return t}()},{key:"addParticipants",value:function(){function t(t,e){return e?this.update(v,function(n){return n.withMutations(function(n){e.forEach(function(e){var r=l(t,e.id),u=n.get(r);n.set(r,u?e.mergeOver(n.get(r)):e)})})}):this}return t}()},{key:"setViewerID",value:function(){function t(t,e){return this.setIn([g,t],d(e))}return t}()},{key:"toJSON",value:function(){function t(){return this.toJS()}return t}()}],[{key:"create",value:function(){function t(t){return new e({options:t})}return t}()}]),e}(I);r.default=T},2239);