__d(function(e,t,r,a){function n(e){_.default.push(Z.VIEW_TRIP_INSTANCE,{tripInstanceIdFromEntryPoint:e})}function i(e,t){_.default.push(Z.VIEW_EXPERIENCE_INSTANCE,{selectedExperienceInstanceId:e,selectedTripInstanceId:t})}function l(e,t){t?(0,W.executeArray)([function(){return n(e)},function(){return i(t,e)}]):n(e)}Object.defineProperty(a,"__esModule",{value:!0});var s=t(379),o=babelHelpers.interopRequireDefault(s),p=t(562),u=babelHelpers.interopRequireDefault(p),d=t(412),c=babelHelpers.interopRequireDefault(d),f=t(271),b=(babelHelpers.interopRequireDefault(f),t(790)),m=t(44),h=t(1338),g=babelHelpers.interopRequireDefault(h),I=t(1043),T=babelHelpers.interopRequireDefault(I),v=t(1787),y=babelHelpers.interopRequireDefault(v),x=t(773),R=babelHelpers.interopRequireDefault(x),S=t(1374),C=babelHelpers.interopRequireDefault(S),H=t(410),_=babelHelpers.interopRequireDefault(H),D=t(787),E=babelHelpers.interopRequireDefault(D),A=t(422),q=babelHelpers.interopRequireDefault(A),P=t(1352),j=babelHelpers.interopRequireDefault(P),w=t(789),k=babelHelpers.interopRequireDefault(w),L=t(1788),N=babelHelpers.interopRequireDefault(L),z=t(1789),V=t(1790),O=t(1791),B=babelHelpers.interopRequireDefault(O),U=t(1793),M=babelHelpers.interopRequireDefault(U),F=t(1794),K=babelHelpers.interopRequireDefault(F),W=t(1796),G=t(1795),Q=t(1752),X=t(1797),Y=t(1798),J=t(1770),Z=babelHelpers.interopRequireWildcard(J),$=t(1803),ee={loadSchedule:c.default.func.isRequired,isScheduleLoading:c.default.bool.isRequired,lastLoad:c.default.number.isRequired,tripInstances:c.default.arrayOf(B.default).isRequired,tripTemplateIds:c.default.arrayOf(c.default.number).isRequired,tripTemplatesById:c.default.object.isRequired,upcomingExperienceInstances:c.default.arrayOf(M.default).isRequired,upcomingTripInstances:c.default.arrayOf(M.default).isRequired,version:c.default.number.isRequired,timezone:c.default.string},te={},re=function(e){var t=(0,$.availabilitySelector)(e),r=(0,$.experienceInstancesSelector)(e),a=(0,$.experienceTemplatesSelector)(e),n=(0,$.tripInstancesSelector)(e),i=(0,$.tripTemplatesSelector)(e),l=(0,$.publishedTripTemplatesSelector)(e),s=t.isScheduleLoading,p=t.lastLoad,u=t.version,d=Object.keys(i).map(function(e){return Number(e)}),c=Object.values(n),f=d.length>0?i[d[0]].market.timezone:null,b=(0,Q.getUpcomingInstanceIds)(c,r),m=b.upcomingExperienceInstanceIds,h=b.upcomingTripInstanceIds,g=h.map(function(e){var t=n[e],r=i[t.associatedTripTemplateId],a=t.endsAt,s=t.guestsCount,p=t.startsAt,u=(0,Q.getDescription)(r).name||o.default.phrase("(Noname)",null,"placeholder for empty experience title"),d=(0,Q.getTripTemplatePhoto)(r),c=(0,Q.isBookedTripInstance)(t)?o.default.phrase("%{smart_count} guest booked |||| %{smart_count} guests booked",{smart_count:s},"text to describe how many guests have booked the trip instance"):null,f=(0,Q.getTripInstanceTimezone)(t,l,i),b=void 0;return b=(0,Q.isSingleExperienceTripInstance)(t)?(0,G.formatDateTimeRange)(p,a,f):(0,G.formatDateRange)(p,a,f),{experienceInstanceId:null,tripInstanceId:e,name:u,image:d,guestsString:c,durationString:b}}),I=m.map(function(e){var t=r[e],s=t.associatedExperienceTemplateId,p=t.associatedTripInstanceId,u=a[s],d=(0,Q.getAssociatedTripInstance)(t,n),c=d.guestsCount,f=t.startsAt,b=u.durationHours,m=(0,G.getEndsAt)(f,b),h=(0,Q.getDescription)(u).name||o.default.phrase("(Noname)",null,"placeholder for empty experience title"),g=(0,Q.getExperienceTemplatePhoto)(u),I=(0,Q.isBookedTripInstance)(d)?o.default.phrase("%{smart_count} guest booked |||| %{smart_count} guests booked",{smart_count:c},"text to describe how many guests have booked the trip instance"):null,T=(0,Q.getTripInstanceTimezone)(d,l,i),v=void 0;return v=(0,Q.isSingleExperienceTripInstance)(t)?(0,G.formatDateTimeRange)(f,m,T):(0,G.formatDateRange)(f,m,T),{experienceInstanceId:e,tripInstanceId:p,name:h,image:g,guestsString:I,durationString:v}});return{isScheduleLoading:s,lastLoad:p,timezone:f,tripInstances:c,tripTemplateIds:d,tripTemplatesById:i,upcomingExperienceInstances:I,upcomingTripInstances:g,version:u}},ae={loadSchedule:X.loadSchedule},ne=function(e){function t(r){babelHelpers.classCallCheck(this,t);var a=babelHelpers.possibleConstructorReturn(this,e.call(this,r));return a.scheduleTrip=a.scheduleTrip.bind(a),a.selectDate=a.selectDate.bind(a),a.tripCache=new K.default,a.updateCache(a.props),a}return babelHelpers.inherits(t,e),t.prototype.componentWillReceiveProps=function(e){this.props.version!==e.version&&this.updateCache(e)},t.prototype.componentDidMount=function(){this.shouldReload()&&this.props.loadSchedule()},t.prototype.shouldReload=function(){var e=this.props.lastLoad;return!e||u.default.unix(e).add(1,"hour").isBefore((0,u.default)())},t.prototype.updateCache=function(e){var t=e.timezone,r=e.tripInstances,a=e.tripTemplatesById;this.tripCache.update(r,a,{timezone:t})},t.prototype.scheduleTrip=function(){var e=this.props,t=e.tripTemplateIds,r=e.tripTemplatesById,a=t.filter(function(e){return z.QUEUE_STATUSES_FOR_SCHEDULING.includes(r[e].queueStatus)});(0,Y.logAddAvailabilityEvent)(),1===a.length?(_.default.present(Z.ADD_TRIP_INSTANCE_PICK_DATE,{selectedTripTemplateId:a[0]}),(0,Y.logEvent)("ViewSchedule",{operation:"schedule_trip",next_screen:"ADD_TRIP_INSTANCE_PICK_DATE"})):(_.default.present(Z.ADD_TRIP_INSTANCE_PICK_TRIP_TEMPLATE),(0,Y.logEvent)("ViewSchedule",{operation:"schedule_trip",next_screen:"PICK_TRIP_TEMPLATE"}))},t.prototype.selectDate=function(e){var t=this.tripCache.getTripInstanceId(e);t&&(n(t),(0,Y.logEvent)("ViewSchedule",{operation:"select_date",date:e,scheduled_template_id:t}))},t.prototype.renderAddAvailability=function(){return this.props.tripTemplateIds.length<1?null:babelHelpers.jsx(m.View,{style:ie.sectionContainer},void 0,babelHelpers.jsx(T.default,{dark:!0,onPress:this.scheduleTrip},void 0,o.default.phrase("Add availability",null,"button caption for click to add new trip instance")))},t.prototype.renderUpcoming=function(){var e=this.props,t=e.upcomingExperienceInstances,r=e.upcomingTripInstances,a=t.concat(r),n=a.length;return n<1?null:babelHelpers.jsx(m.View,{},void 0,babelHelpers.jsx(m.View,{style:ie.sectionContainer},void 0,babelHelpers.jsx(m.View,{style:ie.upcomingTextContainer},void 0,babelHelpers.jsx(m.Text,{style:ie.upcomingText},void 0,o.default.phrase("Upcoming experiences",null,"section header for upcoming experiences")))),babelHelpers.jsx(g.default,{},void 0,n>0&&a.map(function(e,t){return babelHelpers.jsx(m.View,{style:[ie.imageCard,0===t&&ie.firstImageCard,t===n-1&&ie.lastImageCard]},t,babelHelpers.jsx(y.default,{image:e.image,title:e.name,subtitles:[e.durationString,e.guestsString],onPress:function(){return l(e.tripInstanceId,e.experienceInstanceId)}}))})))},t.prototype.renderCalendar=function(){var e=this,t=(0,u.default)().format(z.API_DATE_FORMAT),r=this.tripCache.buildCalendarMonthProps();return babelHelpers.jsx(m.View,{style:ie.calendarContainer,removeClippedSubviews:!0},void 0,r.map(function(r){var a=r.month,n=r.year,i=r.dayStates;return babelHelpers.jsx(C.default,{isSection:!0,today:t,dayStates:i,month:a,year:n,onDayPress:e.selectDate,loading:null==i},a)}))},t.prototype.render=function(){var e=this.props.isScheduleLoading,t=babelHelpers.jsx(R.default,{padSubtitle:!1,title:o.default.phrase("Your schedule",null,"page title for host to view schedule"),subtitle:o.default.phrase("Guests can instantly book any dates you make available, so make sure your availability is up to date.",null,"page subtitle to reminder host keep calendar up to date")});return babelHelpers.jsx(m.View,{style:ie.container},void 0,babelHelpers.jsx(E.default,{style:ie.container,refreshControl:babelHelpers.jsx(m.RefreshControl,{refreshing:!1,onRefresh:this.props.loadSchedule})},void 0,t,e&&babelHelpers.jsx(N.default,{}),!e&&this.renderAddAvailability(),!e&&this.renderUpcoming(),!e&&this.renderCalendar()),babelHelpers.jsx(k.default,{},void 0,babelHelpers.jsx(j.default,{id:V.LOAD_SCHEDULE_FAILED_TOAST,description:o.default.phrase("Something went wrong when loading your schedule",null,"text to tell user it fails to load schedule"),action:o.default.phrase("Try again",null,"link title for click to retry"),onActionPress:this.props.loadSchedule})))},t}(f.Component);ne.propTypes=ee,ne.defaultProps=te;var ie=q.default.create(function(e){var t=e.bp,r=e.font,a=e.size;return{container:{flex:1},sectionContainer:{paddingHorizontal:a.horizontal.medium,paddingBottom:a.vertical.medium},calendarContainer:{paddingTop:3*t},upcomingTextContainer:{paddingBottom:2*t},upcomingText:r.title3Bold,imageCard:{overflow:"hidden",paddingRight:1.5*t},firstImageCard:{paddingLeft:a.horizontal.medium},lastImageCard:{paddingRight:a.horizontal.medium}}});a.default=(0,b.connect)(re,ae)(ne)},1786);