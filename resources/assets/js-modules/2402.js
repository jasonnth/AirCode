__d(function(e,t,o,i){function a(e){return e.checked?e.added_details?f.default.phrase("Edit details",null,"cta to edit a house rule's details"):f.default.phrase("Add details",null,"cta to add more details to a house rule"):null}Object.defineProperty(i,"__esModule",{value:!0});var n=t(412),s=babelHelpers.interopRequireDefault(n),r=t(271),l=(babelHelpers.interopRequireDefault(r),t(790)),p=t(654),d=t(832),u=babelHelpers.interopRequireDefault(d),c=t(820),E=babelHelpers.interopRequireDefault(c),h=t(379),f=babelHelpers.interopRequireDefault(h),x=t(1352),b=babelHelpers.interopRequireDefault(x),g=t(841),T=babelHelpers.interopRequireDefault(g),v=t(410),D=babelHelpers.interopRequireDefault(v),S=t(778),y=babelHelpers.interopRequireDefault(S),_=t(2403),A=babelHelpers.interopRequireDefault(_),O=t(772),L=babelHelpers.interopRequireDefault(O),H=t(2398),I=t(2404),P=t(2401),R=t(2405),C=t(2406),q=t(2408),m={loadExpectations:s.default.func.isRequired,saveExpectations:s.default.func.isRequired,listingId:s.default.string.isRequired,isLoadingExpectations:s.default.bool.isRequired,isSavingExpectations:s.default.bool.isRequired,initialExpectations:s.default.arrayOf(A.default),popViewControllerOnSave:s.default.bool},k={initialExpectations:[],popViewControllerOnSave:!1},j=function(e){function t(o){babelHelpers.classCallCheck(this,t);var i=babelHelpers.possibleConstructorReturn(this,e.call(this,o));return i.state={expectations:(0,C.getRecordListFromObjectArray)(i.props.initialExpectations)},i.onDoneEditingExpectations=i.onDoneEditingExpectations.bind(i),i.onEditDetailsPressed=i.onEditDetailsPressed.bind(i),i.onExpectationToggled=i.onExpectationToggled.bind(i),i.onLoadExpectations=i.onLoadExpectations.bind(i),i.onSaveExpectations=i.onSaveExpectations.bind(i),i}return babelHelpers.inherits(t,e),t.prototype.hasChangedExpectations=function(){var e=this.props.initialExpectations,t=this.state.expectations;if(e.length!==t.size)return!0;for(var o=0;o<e.length;o+=1){var i=e[o],a=t.get(o),n=a.checked&&i.added_details!==a.added_details;if(i.checked!==a.checked||n)return!0}return!1},t.prototype.onDoneEditingExpectations=function(){if(!this.hasChangedExpectations())return void this.finish();this.onSaveExpectations()},t.prototype.finish=function(){var e=this.props.popViewControllerOnSave,t=this.state.expectations,o=(0,C.clearUncheckedAddedDetails)(t).toJS();e?D.default.pop():D.default.dismiss({resultCode:D.default.RESULT_OK,expectations:o},{preProcess:!1})},t.prototype.componentDidMount=function(){var e=this.props.isLoadingExpectations;this.state.expectations.isEmpty()&&!e&&this.onLoadExpectations()},t.prototype.onLoadExpectations=function(){var e=this;this.props.loadExpectations(this.props.listingId).then(function(t){e.setState({expectations:(0,C.getRecordListFromObjectArray)(t.payload)})})},t.prototype.onSaveExpectations=function(){var e=this;this.props.saveExpectations(this.props.listingId,this.state.expectations).then(function(t){t.success&&e.finish()})},t.prototype.onEditDetailsPressed=function(e){var t=this,o=e.type;D.default.present(H.EDIT_EXPECTATION_DETAILS,{expectation:e.toJS()}).then(function(e){e.payload&&void 0!==e.payload.added_details&&t.updateExpectation(o,"added_details",e.payload.added_details)})},t.prototype.updateExpectation=function(e,t,o){var i=this.state.expectations,a=(0,C.getExpectationIndexByType)(i,e);this.setState({expectations:i.setIn([a,t],o)})},t.prototype.onExpectationToggled=function(e){this.updateExpectation(e.type,"checked",!e.checked)},t.prototype.getToasts=function(){var e=this;return[R.LOAD_EXPECTATIONS_FAILED_TOAST,R.UPDATE_EXPECTATIONS_FAILED_TOAST].map(function(t){return babelHelpers.jsx(b.default,{id:t,description:t===R.LOAD_EXPECTATIONS_FAILED_TOAST?f.default.phrase("We had trouble loading house expectations.",null,"Error while loading house rules and expectations screen"):f.default.phrase("We had trouble saving house expectations.",null,"Error while loading house rules and expectations screen"),action:f.default.phrase("Try again",null,"Prompt to try reloading expectations"),onActionPress:t===R.LOAD_EXPECTATIONS_FAILED_TOAST?e.onLoadExpectations:e.onSaveExpectations},t)})},t.prototype.render=function(){var e=this,t=this.props,o=t.isLoadingExpectations,i=t.isSavingExpectations,n=this.state.expectations;return babelHelpers.jsx(L.default,{title:f.default.phrase("Details guests must know about your home",null,"Title on house rules and expectations sheet"),subtitle:f.default.phrase("Set expectations about your home that your guests must agree to before booking.",null,"Subtitle explaining listing expectations"),footer:babelHelpers.jsx(u.default,{babu:!0,buttonText:f.default.phrase("Save",null,"save house rules and expectations"),loading:i||o,onButtonPress:this.onDoneEditingExpectations}),toasts:this.getToasts()},void 0,o?babelHelpers.jsx(T.default,{}):babelHelpers.jsx(y.default,{},void 0,n.map(function(t){return babelHelpers.jsx(E.default,{title:t.title,subtitle:t.checked?t.added_details:null,checked:t.checked,actionTitle:a(t),disabled:i,onToggle:function(){return e.onExpectationToggled(t)},onActionPress:function(){return e.onEditDetailsPressed(t)}},t.type)})))},t}(r.PureComponent);j.propTypes=m,j.defaultProps=k;var N=function(e){return{isLoadingExpectations:(0,I.rootSelector)(e).get(P.LOADING_EXPECTATIONS_KEY),isSavingExpectations:(0,I.rootSelector)(e).get(P.SAVING_EXPECTATIONS_KEY)}},X=function(e){return(0,p.bindActionCreators)({loadExpectations:q.loadExpectations,saveExpectations:q.saveExpectations},e)};i.default=(0,l.connect)(N,X)(j)},2402);