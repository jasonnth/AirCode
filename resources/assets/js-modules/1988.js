__d(function(e,t,r,i){function n(e){var t=e.endsAt,r=e.startsAt,i=e.timezone,n=e.title,o=e.titlePast,l=e.titleFuture,a=(0,A.getDatesMetadata)(r,t,i);return a.isUpcoming?l:a.isPast?o:n}Object.defineProperty(i,"__esModule",{value:!0});var o=t(412),l=babelHelpers.interopRequireDefault(o),a=t(271),s=(babelHelpers.interopRequireDefault(a),t(44)),d=t(790),u=t(1023),c=t(654),p=t(410),f=babelHelpers.interopRequireDefault(p),h=t(1930),m=t(1482),C=babelHelpers.interopRequireWildcard(m),S=t(1922),T=t(1818),b=t(1957),E=t(708),R=babelHelpers.interopRequireDefault(E),A=t(1937),g=t(1963),I=t(1938),v=t(1989),y=t(1936),P=t(1991),_=babelHelpers.interopRequireDefault(P),D=t(1952),x=babelHelpers.interopRequireDefault(D),L=t(1956),H=babelHelpers.interopRequireDefault(L),M=t(1953),N=babelHelpers.interopRequireDefault(M),O=t(1993),F=babelHelpers.interopRequireDefault(O),q=s.Dimensions.get("window").height,B="android"===s.Platform.OS,j=u.ThemedStyleSheet.create(function(e){var t=e.color,r=e.font;return{cardsContainer:{flex:1},container:{backgroundColor:t.white,flexDirection:"column"},contentContainer:{minHeight:q},boldText:r.smallBold,tabletContainer:{width:b.ITINERARY_CONTAINER_TABLET_WIDTH,marginLeft:b.ITINERARY_CONTAINER_TABLET_MARGIN_LEFT},timelineFillContainer:{marginTop:-1,marginBottom:-2,flex:1}}}),w=function(e){function t(r,i){babelHelpers.classCallCheck(this,t);var n=babelHelpers.possibleConstructorReturn(this,e.call(this,r,i));return n.renderCard=n.renderCard.bind(n),n.onMomentumScrollEnd=n.onMomentumScrollEnd.bind(n),n.updateTripScheduleCards=n.updateTripScheduleCards.bind(n),n}return babelHelpers.inherits(t,e),t.prototype.componentDidMount=function(){this.props.tripSchedule?this.fetchTripScheduleCards(this.props.tripSchedule.confirmationCode):this.props.fetchTripSchedule(this.props.confirmationCode),R.default.emitter.addListener(R.default.EXPERIENCE_BOOKED,this.updateTripScheduleCards),R.default.emitter.addListener(R.default.RESTAURANT_BOOKED,this.updateTripScheduleCards),R.default.emitter.addListener(R.default.RESERVATION_UPDATED,this.updateTripScheduleCards)},t.prototype.componentWillUnmount=function(){R.default.emitter.removeListener(R.default.EXPERIENCE_BOOKED,this.updateTripScheduleCards),R.default.emitter.removeListener(R.default.RESTAURANT_BOOKED,this.updateTripScheduleCards),R.default.emitter.removeListener(R.default.RESERVATION_UPDATED,this.updateTripScheduleCards)},t.prototype.componentWillReceiveProps=function(e){this.props.cards!==e.cards&&s.LayoutAnimation.configureNext(s.LayoutAnimation.Presets.easeInEaseOut),!this.props.tripSchedule&&e.tripSchedule&&(e.tripSchedule?this.fetchTripScheduleCards(e.tripSchedule.confirmationCode):f.default.dismiss())},t.prototype.updateTripScheduleCards=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.props,r=t.cards,i=t.confirmationCode;r.map(function(e){return e.confirmationCode}).includes(e.confirmationCode)&&this.props.fetchTripScheduleCards(i)},t.prototype.fetchTripScheduleCards=function(e){(0,A.shouldFetch)(this.props.lastSyncedAt)&&this.props.fetchTripScheduleCards(e)},t.prototype.onMomentumScrollEnd=function(e){var t=this.props,r=t.tripSchedule,i=t.cards,n=e.nativeEvent.contentOffset.y,o=void 0!==this.prevY||n<this.prevY;this.prevY=n,r&&(0,g.logScrollItineraryEvent)(r.confirmationCode,i.length,o)},t.prototype.renderCard=function(e,t){var r=this.props,i=r.cards,o=r.inverseIndex,l=r.tripSchedule,a=r.onPressCard,s=r.onPressMiniPicture,d=r.onPressSubtitle,u=e.category,c=e.cardType,p=e.confirmationCode,f=e.endsAt,h=e.id,m=e.picture,C=e.secondaryPicture,S=e.startsAt,b=e.subtitle,E=e.timezone,R=(0,A.getTimelineColorForIndex)(t+2,{startIndex:o,gray:S&&(0,I.isUpcoming)(S,E)}),g=c+"-"+h;return c===T.FREE_TIME_CARD?babelHelpers.jsx(_.default,{confirmationCode:l.confirmationCode,id:h,endsAt:(0,A.getDate)(f,E),startsAt:(0,A.getDate)(S,E)},g):babelHelpers.jsx(x.default,{airmoji:T.AIRMOJI_CARD_MAPPING[u],color:R,iconColor:R[0],iconSize:H.default.SIZE_SMALL,suptitle:(0,I.formatDate)(S,E)+" \xb7 "+(0,I.formatTime)(S,E),suptitlePrefix:(0,I.formatDay)(S,E),title:n(e),subtitle:b.value,pictures:[m],miniPicture:C.value,onPress:function(){return a(c,p,l.confirmationCode,l.pictures[0])},onPressMiniPicture:function(){return s(c,p,l.confirmationCode,C.params.id)},onPressSubtitle:function(){return d(b.type,b.params,p,c)},withBottomSpacing:t===i.length-1,withTopSpacing:(i[t-1]||{}).cardType===T.FREE_TIME_CARD},g)},t.prototype.getTitle=function(){var e=this.props.tripSchedule;return e?e.title:null},t.prototype.getColorsForFillRow=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.props,r=t.cards,i=t.inverseIndex,n=r.length,o=r[n-1],l=e;return o&&(l={gray:(0,I.isUpcoming)(o.startsAt,o.timezone),startIndex:i}),(0,A.getTimelineColorForIndex)(n+2,l)},t.prototype.renderNavBar=function(){return B?babelHelpers.jsx(f.default.Screen,{barType:f.default.Screen.BAR_TYPE.STATIC,title:this.getTitle(),leftIcon:f.default.Screen.LEFT_ICON.NAV_LEFT}):null},t.prototype.render=function(){var e=this.props,t=e.cards,r=e.inverseIndex,i=e.isLoading,n=e.tripSchedule,o={gray:n&&(0,I.isUpcoming)(n.startsAt,n.timezone),startIndex:r};return babelHelpers.jsx(s.ScrollView,{onMomentumScrollEnd:this.onMomentumScrollEnd,showsVerticalScrollIndicator:!b.IS_TABLET,style:[j.container,b.IS_TABLET&&j.tabletContainer]},void 0,this.renderNavBar(),babelHelpers.jsx(s.View,{style:j.contentContainer},void 0,babelHelpers.jsx(N.default,{color:(0,A.getTimelineColorForIndex)(0,o),initialHeight:60,type:N.default.TYPE_SQUIGGLE}),babelHelpers.jsx(x.default,{color:(0,A.getTimelineColorForIndex)(1,o),contentCentered:!0,height:310,isLoading:i,subtitle:n?(0,I.smartRangeFormat)(n.startsAt,n.endsAt,n.timezone,{allDay:!0,monthFormat:"MMMM"}):null,subtitleLarge:!0,title:this.getTitle(),titleLarge:!0,type:x.default.Timeline.TYPE_CURVE}),babelHelpers.jsx(s.View,{style:j.cardsContainer},void 0,t.map(this.renderCard),babelHelpers.jsx(s.View,{style:j.timelineFillContainer},void 0,babelHelpers.jsx(x.default,{color:this.getColorsForFillRow(o),fill:!0})))))},t}(a.Component);w.propTypes={cards:l.default.arrayOf(F.default),index:l.default.number,inverseIndex:l.default.number,isLoading:l.default.bool,lastSyncedAt:l.default.number,confirmationCode:l.default.string,tripSchedule:l.default.object,fetchTripScheduleCards:l.default.func.isRequired,fetchTripSchedule:l.default.func.isRequired,onPressCard:l.default.func.isRequired,onPressMiniPicture:l.default.func.isRequired,onPressSubtitle:l.default.func.isRequired},w.defaultProps={cards:[],isLoading:!1,lastSyncedAt:null},i.default=(0,d.connect)(function(e,t){return(0,y.timelineIndividualContainerSelector)(e,t)},function(e){return{fetchTripScheduleCards:(0,c.bindActionCreators)(h.fetchTripScheduleCards,e),fetchTripSchedule:(0,c.bindActionCreators)(h.fetchTripSchedule,e),onPressCard:function(e,t,r,i){(0,g.logCardItemEvent)(t,e,r),f.default.present(S.ITINERARY_CARD,{cardType:e,id:t,tripScheduleId:r,picture:i}).then(function(e){var t=e.payload;t&&t.resultStatus===T.RESERVATION_WAS_CANCELLED&&f.default.pop()})},onPressMiniPicture:function(e,t,r,i){(0,g.logHostEvent)(i,t,e,r,"t1"),f.default.push(C.USER_PROFILE,{user_id:i})},onPressSubtitle:function(e,t,r,i){e===T.ACTION_TYPE_ADDRESS&&(0,v.openMapProvidersActionSheet)(t,r,i,"t1",!1)}}})(w)},1988);