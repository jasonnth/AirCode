__d(function(e,t,o,n){var r=t(412),i=babelHelpers.interopRequireDefault(r),s=t(271),l=babelHelpers.interopRequireDefault(s),d=t(44),a=t(25),h=t(256),u=babelHelpers.interopRequireDefault(h),p=t(269),c=babelHelpers.interopRequireDefault(p),R=t(237),f=babelHelpers.interopRequireDefault(R),w=t(270),g=babelHelpers.interopRequireDefault(w),C=t(116),v=babelHelpers.interopRequireDefault(C),b=t(2287),S=t(2288),m=babelHelpers.interopRequireDefault(S),L=l.default.createClass({displayName:"MessageListView",childFrames:[],sentEndForContentLength:null,scrollComponent:null,prevRenderedRowsCount:0,visibleRows:{},scrollProperties:{},mixins:[u.default.Mixin,f.default],statics:{DataSource:m.default},propTypes:babelHelpers.extends({},d.ScrollView.propTypes,{dataSource:i.default.instanceOf(m.default).isRequired,renderRow:i.default.func.isRequired,initialListSize:i.default.number.isRequired,onEndReached:i.default.func,onEndReachedThreshold:i.default.number.isRequired,pageSize:i.default.number.isRequired,renderFooter:i.default.func,renderHeader:i.default.func,renderScrollComponent:i.default.func.isRequired,scrollRenderAheadDistance:i.default.number.isRequired,onChangeVisibleRows:i.default.func,removeClippedSubviews:i.default.bool}),getMetrics:function(){return{contentLength:this.scrollProperties.contentLength,totalRows:this.props.dataSource.getRowCount(),renderedRows:this.state.curRenderedRowsCount,visibleRows:Object.keys(this.visibleRows).length}},getScrollResponder:function(){return this.scrollComponent&&this.scrollComponent.getScrollResponder?this.scrollComponent.getScrollResponder():null},scrollTo:function(){if(this.scrollComponent&&this.scrollComponent.scrollTo){var e;(e=this.scrollComponent).scrollTo.apply(e,arguments)}},setNativeProps:function(e){this.scrollComponent&&this.scrollComponent.setNativeProps(e)},getDefaultProps:function(){return{initialListSize:10,pageSize:1,renderScrollComponent:function(e){return l.default.createElement(d.ScrollView,e)},scrollRenderAheadDistance:1e3,onEndReachedThreshold:1e3,stickyHeaderIndices:[]}},getInitialState:function(){return{curRenderedRowsCount:this.props.initialListSize,highlightedRow:{}}},getInnerViewNode:function(){return this.scrollComponent.getInnerViewNode()},componentWillMount:function(){this.scrollProperties={visibleLength:null,contentLength:null,offset:0},this.childFrames=[],this.visibleRows={},this.prevRenderedRowsCount=0,this.sentEndForContentLength=null},componentDidMount:function(){var e=this;this.requestAnimationFrame(function(){e.measureAndUpdateScrollProps()})},componentWillReceiveProps:function(e){var t=this;this.props.dataSource===e.dataSource&&this.props.initialListSize===e.initialListSize||this.setState(function(e,o){return t.prevRenderedRowsCount=0,{curRenderedRowsCount:Math.min(Math.max(e.curRenderedRowsCount,o.initialListSize),o.dataSource.getRowCount())}},function(){return t.renderMoreRowsIfNeeded()})},componentDidUpdate:function(){var e=this;this.requestAnimationFrame(function(){e.measureAndUpdateScrollProps()})},render:function(){var e=this,t=this.props.dataSource,o=[],n=this.props.renderHeader&&this.props.renderHeader(),r=this.props.renderFooter&&this.props.renderFooter(),i=this.props.getRowId,s=n?1:0;(0,b.iterateSurrounding)(t.iterator(),function(n,r,l,d){var a=d>=e.prevRenderedRowsCount&&t.rowShouldUpdate(d),h=babelHelpers.jsx(c.default,{shouldUpdate:!!a,render:e.props.renderRow.bind(null,n,r,l,d)},"r_"+i(n));return o.push(h),s+=1,d===e.state.curRenderedRowsCount});var l=this.props,d=l.renderScrollComponent,a=babelHelpers.objectWithoutProperties(l,["renderScrollComponent"]);return a.scrollEventThrottle||(a.scrollEventThrottle=50),void 0===a.removeClippedSubviews&&(a.removeClippedSubviews=!0),babelHelpers.extends(a,{onScroll:this.onScroll,onKeyboardWillShow:void 0,onKeyboardWillHide:void 0,onKeyboardDidShow:void 0,onKeyboardDidHide:void 0}),(0,g.default)(d(a),{ref:this.setScrollComponentRef,onContentSizeChange:this.onContentSizeChange,onLayout:this.onLayout},n,o,r)},measureAndUpdateScrollProps:function(){var e=this.getScrollResponder();e&&e.getInnerViewNode&&a.ScrollViewManager&&a.ScrollViewManager.calculateChildFrames&&a.ScrollViewManager.calculateChildFrames((0,d.findNodeHandle)(e),this.updateVisibleRows)},setScrollComponentRef:function(e){this.scrollComponent=e},onContentSizeChange:function(e,t){var o=this.props.horizontal?e:t;o!==this.scrollProperties.contentLength&&(this.scrollProperties.contentLength=o,this.updateVisibleRows(),this.renderMoreRowsIfNeeded()),this.props.onContentSizeChange&&this.props.onContentSizeChange(e,t)},onLayout:function(e){var t=e.nativeEvent.layout,o=t.width,n=t.height,r=this.props.horizontal?o:n;r!==this.scrollProperties.visibleLength&&(this.scrollProperties.visibleLength=r,this.updateVisibleRows(),this.renderMoreRowsIfNeeded()),this.props.onLayout&&this.props.onLayout(e)},maybeCallOnEndReached:function(e){return!!(this.props.onEndReached&&this.scrollProperties.contentLength!==this.sentEndForContentLength&&this.getDistanceFromEnd(this.scrollProperties)<this.props.onEndReachedThreshold&&this.state.curRenderedRowsCount===this.props.dataSource.getRowCount())&&(this.sentEndForContentLength=this.scrollProperties.contentLength,this.props.onEndReached(e),!0)},renderMoreRowsIfNeeded:function(){if(null===this.scrollProperties.contentLength||null===this.scrollProperties.visibleLength||this.state.curRenderedRowsCount===this.props.dataSource.getRowCount())return void this.maybeCallOnEndReached();this.getDistanceFromEnd(this.scrollProperties)<this.props.scrollRenderAheadDistance&&this.pageInNewRows()},pageInNewRows:function(){var e=this;this.setState(function(t,o){var n=Math.min(t.curRenderedRowsCount+o.pageSize,o.dataSource.getRowCount());return e.prevRenderedRowsCount=t.curRenderedRowsCount,{curRenderedRowsCount:n}},function(){e.measureAndUpdateScrollProps(),e.prevRenderedRowsCount=e.state.curRenderedRowsCount})},getDistanceFromEnd:function(e){return e.contentLength-e.visibleLength-e.offset},updateVisibleRows:function(e){var t=this;if(this.props.onChangeVisibleRows){e&&e.forEach(function(e){t.childFrames[e.index]=(0,v.default)(e)});var o=!this.props.horizontal,n=this.props.dataSource,r=this.scrollProperties.offset,i=r+this.scrollProperties.visibleLength,s=this.props.renderHeader&&this.props.renderHeader(),l=s?1:0,d=!1,a={},h=this.props.getRowId,u=this.visibleRows||{};(0,b.iterateSurrounding)(n.iterator(),function(e,n,s,p){var c=h(e),R=t.childFrames[l];if(l+=1,!R)return!0;var f=u[c],w=o?R.y:R.x,g=w+(o?R.height:R.width);return!w&&!g||w===g||(w>i||g<r?f&&(d=!0,delete u[c],a[c]=!1):f||(d=!0,u[c]=!0,a[c]=!0),!1)}),d&&this.props.onChangeVisibleRows(this.visibleRows,a)}},onScroll:function(e){var t=!this.props.horizontal;this.scrollProperties.visibleLength=e.nativeEvent.layoutMeasurement[t?"height":"width"],this.scrollProperties.contentLength=e.nativeEvent.contentSize[t?"height":"width"],this.scrollProperties.offset=e.nativeEvent.contentOffset[t?"y":"x"],this.updateVisibleRows(e.nativeEvent.updatedChildFrames),this.maybeCallOnEndReached(e)||this.renderMoreRowsIfNeeded(),this.props.onEndReached&&this.getDistanceFromEnd(this.scrollProperties)>this.props.onEndReachedThreshold&&(this.sentEndForContentLength=null),this.props.onScroll&&this.props.onScroll(e)}});o.exports=L},2286);