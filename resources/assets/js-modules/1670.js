__d(function(e,t,o,i){function n(e){return g.default.isTablet?600:Math.round(e/W)}Object.defineProperty(i,"__esModule",{value:!0});var s=t(271),r=babelHelpers.interopRequireDefault(s),a=t(834),d=t(44),p=t(1671),u=babelHelpers.interopRequireDefault(p),l=t(782),h=babelHelpers.interopRequireDefault(l),c=t(790),b=t(654),f=t(1023),m=t(811),v=babelHelpers.interopRequireDefault(m),y=t(420),g=babelHelpers.interopRequireDefault(y),S=t(1581),T=babelHelpers.interopRequireDefault(S),I=t(1348),V=babelHelpers.interopRequireDefault(I),R=t(1674),w=babelHelpers.interopRequireDefault(R),x=t(410),P=babelHelpers.interopRequireDefault(x),C=t(1584),H=babelHelpers.interopRequireDefault(C),M=t(1675),D=t(1633),q=t(714),A=babelHelpers.interopRequireDefault(q),O=t(1609),E=t(1573),j={prefetchedUri:a.Types.string,photos:a.Types.arrayOf(a.Types.shape({id:a.Types.number.isRequired,url:a.Types.string.isRequired})).isRequired,tripTemplate:a.Types.object,tripTemplateId:a.Types.number.isRequired,videoId:a.Types.number,videoUri:a.Types.string,coverFocused:a.Types.bool,soundOn:a.Types.bool.isRequired,toggleSound:a.Types.func.isRequired,setTimeout:a.Types.func.isRequired},L={tripTemplate:null,coverFocused:!1,videoId:0,videoUri:null},U=function(e){return{toggleSound:(0,b.bindActionCreators)(E.toggleSound,e)}},W=.7894736842105263,F=function(e){function o(t){babelHelpers.classCallCheck(this,o);var i=babelHelpers.possibleConstructorReturn(this,e.call(this,t));return i.state={isWishListed:!1,isOnScreen:!1,canPlayVideo:!1,videoOpacity:new d.Animated.Value(0),posterOpacity:new d.Animated.Value(1)},i.videoMetadata={},i.videoCompletionCount=0,i.currentIndex=0,i.toIndex=1,i.setVideoRef=i.setVideoRef.bind(i),i.setSwipeMarqueeRef=i.setSwipeMarqueeRef.bind(i),i.setVideoMetadata=i.setVideoMetadata.bind(i),i.onAppear=i.onAppear.bind(i),i.onDisappear=i.onDisappear.bind(i),i.onVideoEnded=i.onVideoEnded.bind(i),i.onVideoLoaded=i.onVideoLoaded.bind(i),i.onVolumeChange=i.onVolumeChange.bind(i),i.onTapSoundSwitch=i.onTapSoundSwitch.bind(i),i.onIndexChange=i.onIndexChange.bind(i),i.autoSwipe=i.autoSwipe.bind(i),i}return babelHelpers.inherits(o,e),o.prototype.componentWillMount=function(){this.setState({isOnScreen:!0})},o.prototype.componentDidMount=function(){var e=this;this.subscription=A.default.subscribeIsWishlisted(A.default.TYPE.TRIP,this.props.tripTemplateId,function(t){return e.setState({isWishListed:t})}),this.props.setTimeout(function(){e.setState({canPlayVideo:!0})},900),(0,y.subscribeVolumeUpdated)(this.onVolumeChange),this.props.soundOn&&g.default.toggleSoundActive(!0)},o.prototype.componentWillUnmount=function(){A.default.unsubscribe(this.subscription),(0,y.unsubscribeVolumeUpdated)(this.onVolumeChange),g.default.toggleSoundActive(!1),this.interval&&clearInterval(this.interval)},o.prototype.componentDidUpdate=function(e){var t=this.props,o=t.coverFocused,i=t.photos,n=t.tripTemplate,s=t.videoId,r=t.videoUri;if(this.state.videoLoaded&&this.state.canPlayVideo&&this.fadeInAnimations(),!r&&i.length>1&&!this.interval&&(this.interval=setInterval(this.autoSwipe,3e3)),s>0&&e.coverFocused&&!o){var a=this.videoMetadata,d=a.currentTime,p=a.duration,u=void 0;p&&null!==d||(u=0),u=Math.round(1e4*d/p)/100,u+=100*this.videoCompletionCount,(0,O.logPDPVideoStopWatching)(s,u,p,n)}},o.prototype.onIndexChange=function(e){var t=this.currentIndex;this.currentIndex=e;var o=this.props,i=o.photos,n=o.tripTemplate,s=i[this.currentIndex].id;this.currentIndex+1===this.toIndex?(0,O.logPDPSwipePhotoAuto)(s,n):t<this.currentIndex?(this.toIndex=-1,(0,O.logPDPSwipePhotoRight)(s,n)):(this.toIndex=-1,(0,O.logPDPSwipePhotoLeft)(s,n))},o.prototype.setSwipeMarqueeRef=function(e){this.swipeMarqueeRef=e},o.prototype.setVideoRef=function(e){this.videoRef=e},o.prototype.setVideoMetadata=function(e){var t=this.videoMetadata;this.videoMetadata=babelHelpers.extends({},t,e)},o.prototype.autoSwipe=function(){var e=this.props.photos;if(this.toIndex>=e.length||this.toIndex!==this.currentIndex+1)return void(this.interval&&(clearInterval(this.interval),this.toIndex=-1));this.swipeMarqueeRef.scrollToIndex(this.toIndex),this.toIndex+=1},o.prototype.onVideoEnded=function(){this.videoCompletionCount+=1},o.prototype.onVideoLoaded=function(e){this.setState({videoLoaded:!0}),this.setVideoMetadata(e)},o.prototype.onAppear=function(){this.setState({isOnScreen:!0})},o.prototype.onDisappear=function(){this.setState({isOnScreen:!1})},o.prototype.onVolumeChange=function(){this.props.toggleSound(!0),g.default.toggleSoundActive(!0)},o.prototype.onTapSoundSwitch=function(){var e=this.props,t=e.soundOn;e.tripTemplate.product_type===D.PRODUCT_TYPE_EXPERIENCE||(this.logSoundToggle(!t),this.props.toggleSound(!t))},o.prototype.logSoundToggle=function(e){var t=this.props,o=t.tripTemplate,i=t.videoId,n=this.videoMetadata,s=n.currentTime,r=n.duration,a=void 0;r&&null!==s||(a=0),a=Math.round(1e4*s/r)/100,(0,O.logPDPToggleVideoSound)(i,a,o,e)},o.prototype.fadeInAnimations=function(){this.doneFadeInAnimation||(d.Animated.timing(this.state.videoOpacity,{toValue:1,duration:500}).start(),d.Animated.timing(this.state.posterOpacity,{toValue:0,duration:500}).start(),this.doneFadeInAnimation=!0)},o.prototype.renderVideo=function(e,o,i){var n=this.state.isOnScreen&&this.state.canPlayVideo,s=this.props,a=s.coverFocused,p=s.tripTemplate,l=s.soundOn,h=p.product_type===D.PRODUCT_TYPE_EXPERIENCE;return babelHelpers.jsx(d.Animated.View,{style:[d.StyleSheet.absoluteFill,{opacity:this.state.videoOpacity}]},void 0,babelHelpers.jsx(d.TouchableWithoutFeedback,{onPress:this.onTapSoundSwitch},void 0,babelHelpers.jsx(d.View,{},void 0,r.default.createElement(u.default,{ref:this.setVideoRef,source:{uri:e},rate:1,muted:!l,volume:1,repeat:!0,paused:!a||!n,onEnd:this.onVideoEnded,onLoad:this.onVideoLoaded,onProgress:this.setVideoMetadata,resizeMode:"cover",style:{width:o,height:i}}),!h&&babelHelpers.jsx(d.View,{style:_.soundSwitchContainer},void 0,!l&&babelHelpers.jsx(d.Image,{resizeMode:"contain",source:(0,v.default)(t(1676)),style:_.soundSwitch}),l&&babelHelpers.jsx(d.Image,{resizeMode:"contain",source:(0,v.default)(t(1677)),style:_.soundSwitch})))))},o.prototype.render=function(){var e=this,t=this.props,o=t.photos,i=t.prefetchedUri,s=t.tripTemplate,a=t.tripTemplateId,p=t.videoUri,u=(0,H.default)(),l=n(u),h=Math.round(u/.6666666666666666);return babelHelpers.jsx(d.View,{},void 0,babelHelpers.jsx(P.default.Screen,{onAppear:this.onAppear,onDisappear:this.onDisappear}),r.default.createElement(T.default,{ref:this.setSwipeMarqueeRef,showFullWidthItem:!0,itemWidth:u,itemHeight:l,onIndexChange:this.onIndexChange,showPositionIndicator:!p,buttons:[{icon:"share",onPress:function(){return(0,M.showShareTemplateSheet)(s)}},{icon:this.state.isWishListed?"heart":"heart-alt",onPress:function(){return(0,M.toggleWishListTemplate)(s)}}]},o.map(function(t,o){return babelHelpers.jsx(d.Animated.View,{style:{opacity:e.state.posterOpacity}},o,babelHelpers.jsx(V.default,{type:"tripTemplate",typeId:a,subType:"coverPhoto",subTypeId:o},o,babelHelpers.jsx(w.default,{smallSource:0===o?i:null,largeSource:t.url,resizeMode:"cover",style:[{width:u,height:l},0===o&&{height:h,marginBottom:l-h}]})))})),p&&this.renderVideo(p,u,l))},o}(r.default.Component),_=f.ThemedStyleSheet.create(function(e){var t=e.bp,o=e.size;return{soundSwitchContainer:{position:"absolute",left:o.horizontal.medium,bottom:o.horizontal.medium},soundSwitch:{width:4*t,height:4*t}}});F.propTypes=j,F.defaultProps=L,i.default=(0,c.connect)(null,U)((0,h.default)(F))},1670);