__d(function(e,t,a,l){Object.defineProperty(l,"__esModule",{value:!0});var i=t(562),r=babelHelpers.interopRequireDefault(i),s=t(379),n=babelHelpers.interopRequireDefault(s),p=t(412),o=babelHelpers.interopRequireDefault(p),d=t(271),u=(babelHelpers.interopRequireDefault(d),t(790)),c=t(44),h=t(559),f=t(773),b=babelHelpers.interopRequireDefault(f),T=t(1374),D=babelHelpers.interopRequireDefault(T),y=t(410),S=babelHelpers.interopRequireDefault(y),m=t(1057),g=babelHelpers.interopRequireDefault(m),I=t(787),R=babelHelpers.interopRequireDefault(I),v=t(422),H=babelHelpers.interopRequireDefault(v),q=t(1352),C=babelHelpers.interopRequireDefault(q),_=t(789),x=babelHelpers.interopRequireDefault(_),A=t(1788),j=babelHelpers.interopRequireDefault(A),w=t(1789),P=t(1790),k=t(1791),O=babelHelpers.interopRequireDefault(k),L=t(1794),E=babelHelpers.interopRequireDefault(L),B=t(1795),F=t(1752),M=t(1797),N=t(1798),z=t(1770),W=babelHelpers.interopRequireWildcard(z),U=t(1803),V={addTripInstance:o.default.func.isRequired,isScheduleLoading:o.default.bool.isRequired,isSchedulerLoading:o.default.bool.isRequired,tripInstances:o.default.arrayOf(O.default).isRequired,tripTemplatesById:o.default.object.isRequired,experienceTemplatesById:o.default.object.isRequired,selectedTripTemplateId:o.default.number.isRequired},K={},Z=function(e){var t=(0,U.availabilitySelector)(e),a=t.isScheduleLoading,l=t.isSchedulerLoading,i=(0,U.tripTemplatesSelector)(e),r=(0,U.tripInstancesSelector)(e);return{experienceTemplatesById:(0,U.experienceTemplatesSelector)(e),isScheduleLoading:a,isSchedulerLoading:l,tripInstances:Object.values(r),tripTemplatesById:i}},G={addTripInstance:M.addTripInstance},J=function(e){function t(a){babelHelpers.classCallCheck(this,t);var l=babelHelpers.possibleConstructorReturn(this,e.call(this,a));return l.addToSchedule=l.addToSchedule.bind(l),l.selectDate=l.selectDate.bind(l),l.unselectDate=l.unselectDate.bind(l),l.tripCache=new E.default,l.updateCache(l.props,null),l.state={selectedStartDate:null},l}return babelHelpers.inherits(t,e),t.prototype.shouldComponentUpdate=function(e,t){return!((0,h.shallowObjectEquals)(this.state,t)&&(0,h.shallowObjectEqualsWithKeyComparator)(this.props,e,{tripInstances:h.shallowArrayEquals}))},t.prototype.componentWillReceiveProps=function(e){this.updateCache(e,this.state.selectedStartDate)},t.prototype.buildTentativeTripInstance=function(e,t){var a=e.defaultDurationDays,l=e.id,i=e.market,r=this.props.experienceTemplatesById,s=(0,F.getTemplateFirstExperience)(e,r),n=s.defaultMinute;return{associatedTripTemplateId:l,durationDays:a,id:-1,isTentative:!0,startsAt:(0,F.getNewTripInstanceStartTime)({selectedDate:t,defaultMinute:n,timezoneOffset:i.timezoneOffset})}},t.prototype.getSelectedTripTemplate=function(){var e=this.props,t=e.selectedTripTemplateId;return e.tripTemplatesById[t]},t.prototype.updateCache=function(e,t){var a=e.selectedTripTemplateId,l=e.tripInstances,i=e.tripTemplatesById,r=i[a],s=r.defaultDurationDays,n=r.market,p=n.timezone,o=l.concat();t&&o.push(this.buildTentativeTripInstance(r,t)),this.tripCache.update(o,i,{duration:s,timezone:p})},t.prototype.selectDate=function(e){var t=this.props.isSchedulerLoading,a=this.getSelectedTripTemplate();t||!a.defaultDurationDays||this.tripCache.isUnavailable(e)||(this.updateCache(this.props,e),this.setState({selectedStartDate:e}))},t.prototype.unselectDate=function(){this.updateCache(this.props,null),this.setState({selectedStartDate:null})},t.prototype.addToSchedule=function(){var e=this,t=this.props.isSchedulerLoading,a=this.getSelectedTripTemplate();if(t)return null;var l=a.id,i=this.state.selectedStartDate;return this.props.addTripInstance({selectedStartDate:i,tripTemplateId:l}).then(function(t){t.success&&((0,N.logEvent)("AddTripInstancePickDate",{operation:"added_availability",trip_template_id:l,date:i}),e.unselectDate(),S.default.push(W.ADD_TRIP_INSTANCE_CONFIRMATION))})},t.prototype.renderCalendar=function(){var e=this,t=this.getSelectedTripTemplate().market.timezone,a=(0,B.getTimeWithZone)(null,t).format(w.API_DATE_FORMAT),l=this.tripCache.buildDatePickerMonthProps();return babelHelpers.jsx(c.View,{style:Q.calendarContainer,removeClippedSubviews:!0},void 0,l.map(function(t){var l=t.month,i=t.year,r=t.dayStates;return babelHelpers.jsx(D.default,{isSection:!0,today:a,dayStates:r,month:l,year:i,onDayPress:e.selectDate,loading:null==r},"scheduling-"+l+"-"+i)}))},t.prototype.render=function(){var e=this.props,t=e.isScheduleLoading,a=e.isSchedulerLoading,l=this.getSelectedTripTemplate(),i=l.defaultDurationDays,s=this.state.selectedStartDate,p=s&&i?(0,r.default)(s).add(i-1,"days").format(w.API_DATE_FORMAT):null,o=s&&p?(0,B.formatDateRange)(s,p):null,d=1===l.defaultDurationDays?n.default.phrase("Choose a date",null,"page title for host to pick a single-day trip instance"):n.default.phrase("Choose a start date",null,"page title for host to pick a multi-day trip instance"),u=n.default.phrase("When would you like your experience to start?",null,"page subtitle to ask host provide start date for trip instance"),h=s?n.default.phrase("Schedule for %{dateRange}",{dateRange:o},"caption for button to confirm scheduling trip instance on the date range"):null;return babelHelpers.jsx(c.View,{style:c.StyleSheet.absoluteFill},void 0,babelHelpers.jsx(R.default,{style:c.StyleSheet.absoluteFill},void 0,babelHelpers.jsx(b.default,{padSubtitle:!1,title:d,subtitle:u}),t&&babelHelpers.jsx(j.default,{}),!t&&this.renderCalendar()),babelHelpers.jsx(x.default,{withInsets:[!!s&&g.default]},void 0,babelHelpers.jsx(C.default,{id:P.ADD_TRIP_INSTANCE_FAILED_TOAST,description:n.default.phrase("Something went wrong when scheduling a new experience",null,"text to tell user it fails to create trip instance"),action:n.default.phrase("Try again",null,"link title for click to retry"),onActionPress:this.addToSchedule})),!!s&&babelHelpers.jsx(g.default,{babu:!0,loading:a,onPress:this.addToSchedule},void 0,h))},t}(d.Component);J.propTypes=V,J.defaultProps=K;var Q=H.default.create(function(e){return{calendarContainer:{paddingBottom:8*e.bp}}});l.default=(0,u.connect)(Z,G)(J)},1824);