__d(function(e,t,o,r){function i(e,t){return e+"-"+t}Object.defineProperty(r,"__esModule",{value:!0});var l=t(412),a=babelHelpers.interopRequireDefault(l),s=t(271),n=babelHelpers.interopRequireDefault(s),p=t(44),d=t(790),u=t(654),c=t(562),h=babelHelpers.interopRequireDefault(c),m=t(379),f=babelHelpers.interopRequireDefault(m),T=t(782),b=babelHelpers.interopRequireDefault(T),y=t(1023),S=t(410),g=babelHelpers.interopRequireDefault(S),R=t(787),v=babelHelpers.interopRequireDefault(R),D=t(1374),H=babelHelpers.interopRequireDefault(D),B=t(1413),P=babelHelpers.interopRequireDefault(B),A=t(1738),C=babelHelpers.interopRequireDefault(A),w=t(1684),q=t(1680),_=t(1730),k=t(1695),F=babelHelpers.interopRequireDefault(k),I=t(1633),M=t(1609),V=t(1698),E=babelHelpers.interopRequireDefault(V),x=t(1634),j=babelHelpers.interopRequireDefault(x),O=t(1573),U=babelHelpers.interopRequireWildcard(O),L=t(1569),G=babelHelpers.interopRequireWildcard(L),W=t(1578),z={hasGuests:a.default.bool,selectedScheduledTripTemplate:E.default,scheduledTripTemplates:a.default.arrayOf(E.default).isRequired,scrollMonthKey:a.default.string,tripPrice:a.default.object.isRequired,tripTemplate:j.default.isRequired,tripTemplateId:a.default.number.isRequired,loadTripPrice:a.default.func.isRequired,saveBookingData:a.default.func.isRequired,removeAllAdditionalTravelers:a.default.func.isRequired,setTimeout:a.default.func.isRequired,isMounted:a.default.func.isRequired},N={hasGuests:!1,scrollMonthKey:null,selectedScheduledTripTemplate:null},K=function(e,t){return{tripPrice:(0,W.tripPriceSelector)(e),tripTemplate:(0,W.rootSelector)(e).get("tripTemplatesById").get(t.tripTemplateId),scheduledTripTemplates:(0,W.rootSelector)(e).get("scheduledTripTemplatesByTripTemplateId").get(t.tripTemplateId),selectedScheduledTripTemplate:(0,W.rootSelector)(e).get("bookingData").scheduledTripTemplate,hasGuests:(0,W.rootSelector)(e).get("bookingData").hasGuests}},Y=function(e){return(0,u.bindActionCreators)({loadTripPrice:U.loadTripPrice,saveBookingData:U.saveBookingData,removeAllAdditionalTravelers:U.removeAllAdditionalTravelers},e)},Q="android"===p.Platform.OS,X=87,J=function(e){function t(o){babelHelpers.classCallCheck(this,t);var r=babelHelpers.possibleConstructorReturn(this,e.call(this,o)),i=r.props,l=i.selectedScheduledTripTemplate,a=i.scheduledTripTemplates,s=r.getSelectedScheduledTripTemplate(l);return r.state={months:(0,q.getAvailabilityMonths)(a),selectedScheduledTripTemplate:s,footerContainerBottom:new p.Animated.Value(s?0:-300),footerSummaryBottom:new p.Animated.Value(s?X:-220),scheduledTripDateManager:new F.default(a)},r.monthRefs={},r.monthPositions={},r.onButtonPress=r.onButtonPress.bind(r),r.selectDate=r.selectDate.bind(r),r.setScrollScreen=r.setScrollScreen.bind(r),r.setMonthRef=r.setMonthRef.bind(r),r}return babelHelpers.inherits(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props.scrollMonthKey,o=this.state.months;this.loadTripPrice(),this.props.setTimeout(function(){o.forEach(function(o){var r=o.month,l=o.year,a=i(r,l);e.monthRefs[a].measure(function(o,r,i,l,s,n){e.props.isMounted()&&(e.monthPositions[a]=n,a===t&&e.scrollScreenTo(a))})})},300)},t.prototype.setScrollScreen=function(e){this.scrollScreen=e},t.prototype.setMonthRef=function(e,t,o){this.monthRefs[i(e,t)]=o},t.prototype.scrollScreenTo=function(e){var t=Q?this.monthPositions[e]:this.monthPositions[e]-60;this.scrollScreen.scrollTo({y:t,animated:!0})},t.prototype.slideUpFooterContainer=function(){var e=this.state.footerContainerBottom;p.Animated.timing(e,{toValue:0,duration:200}).start()},t.prototype.slideUpFooterSummary=function(){var e=this.state.footerSummaryBottom;p.Animated.timing(e,{toValue:X,duration:150}).start()},t.prototype.resetFooterContainer=function(){var e=this.state,t=e.footerContainerBottom,o=e.footerSummaryBottom;t.setValue(-300),o.setValue(X)},t.prototype.resetFooterSummary=function(){this.state.footerSummaryBottom.setValue(-220)},t.prototype.getSelectedScheduledTripTemplate=function(e){return e&&this.props.scheduledTripTemplates.some(function(t){return t.id===e.id})?e:null},t.prototype.loadTripPrice=function(){var e=this.props;(0,e.loadTripPrice)({template_id:e.tripTemplateId,guest_count:1})},t.prototype.saveBookingData=function(e,t){var o=this.props,r=o.tripTemplateId,i=o.tripTemplate;this.props.saveBookingData({scheduledTripTemplate:e,hasGuests:t,tripTemplate:i,tripTemplateId:r})},t.prototype.onButtonPress=function(e,t){this.saveBookingData(e,t);var o=this.props,r=o.tripTemplateId,i=o.tripTemplate,l=i.base_price;t?g.default.push(G.ADDITIONAL_TRAVELERS,{tripTemplateId:r}):(this.props.removeAllAdditionalTravelers(),(0,_.isCuba)(i)?g.default.push(G.CUBA_ATTESTATION_FLOW,{tripTemplateId:r}):g.default.push(G.TRAVEL_REQUIREMENTS,{templateId:r,showBookingFooter:!0,prevStep:"date_picker_calendar"})),(0,M.logBookingFlowClickConfirmDates)(l,i,{dates:[e.start_date,e.end_date],singleBooking:!0,spotsLeft:e.remaining_capacity})},t.prototype.dayStatesForMonth=function(e){var t=e.month,o=e.year,r=this.state,i=r.selectedScheduledTripTemplate,l=r.scheduledTripDateManager;return null==l?[]:l.dayStatesForMonth({month:t,year:o,isSmallView:!1,selectedScheduledTripTemplate:i})},t.prototype.selectDate=function(e){var t=this,o=this.props.tripTemplate,r=this.state,l=r.scheduledTripDateManager,a=r.selectedScheduledTripTemplate,s=l.scheduledTripTemplateForDate(e),n=a&&s&&a.id===s.id;if(!s||n)return void this.setState({selectedScheduledTripTemplate:null});var p=s&&18*s.scheduled_experiences.length+X+64;if(this.setState({selectedScheduledTripTemplate:s,fillerBottomHeight:p}),s&&s.id){var d=(0,h.default)(e),u=i(d.month()+1,d.year());this.scrollScreenTo(u)}a?(this.resetFooterSummary(),this.props.setTimeout(function(){t.slideUpFooterSummary()},200)):(this.resetFooterContainer(),this.props.setTimeout(function(){t.slideUpFooterContainer()},200)),(0,M.logBookingFlowDatePickerScreenSelectDate)(o,s)},t.prototype.renderButtonRow=function(){var e=this,t=this.props,o=t.tripPrice,r=t.tripTemplate.product_type,i=this.state.selectedScheduledTripTemplate,l=r===I.PRODUCT_TYPE_EXPERIENCE,a=l?f.default.phrase("Choose date",null,"choose the date and proceed to booking flow on this single day experience"):f.default.phrase("Choose dates",null,"choose the dates and proceed to booking flow on this multi-day experience"),s=!!o.currency;return babelHelpers.jsx(p.View,{style:Z.buttonRow},void 0,babelHelpers.jsx(P.default,{mediumPlus:!0,loading:!s,inactive:!s,onPress:function(){return e.onButtonPress(i,!0)}},void 0,a))},t.prototype.render=function(){var e=this,t=this.props.tripTemplate,o=this.state,r=o.footerContainerBottom,i=o.footerSummaryBottom,l=o.months,a=o.selectedScheduledTripTemplate,s=o.fillerBottomHeight,d=(0,h.default)().format(w.STD_DATE_FORMAT),u=f.default.phrase("When do you want to go?",null,"screen title");return babelHelpers.jsx(p.View,{style:p.StyleSheet.absoluteFill},void 0,babelHelpers.jsx(g.default.Screen,{title:u,barType:g.default.Screen.BAR_TYPE.STATIC}),babelHelpers.jsx(p.View,{style:Z.scrollScreenContainer},void 0,n.default.createElement(v.default,{ref:this.setScrollScreen},babelHelpers.jsx(p.View,{style:Z.filler}),l.map(function(t){var o=t.year,r=t.month;return n.default.createElement(p.View,{ref:e.setMonthRef.bind(e,r,o),key:r+"-"+o,onLayout:function(){}},babelHelpers.jsx(H.default,{isSection:!0,today:d,customizeToday:!1,dayStates:e.dayStatesForMonth({month:r,year:o}),month:r,year:o,respondToDisabledDayPress:!0,onDayPress:e.selectDate}))}),a&&babelHelpers.jsx(p.View,{style:{height:s}}))),a&&babelHelpers.jsx(p.Animated.View,{style:[Z.dateInfoFooterRowContainer,{bottom:r}]},void 0,babelHelpers.jsx(p.Animated.View,{style:[Z.footerSummary,{bottom:i}]},void 0,babelHelpers.jsx(C.default,{tripTemplate:t,scheduledTripTemplate:a})),this.renderButtonRow()))},t}(n.default.Component),Z=y.ThemedStyleSheet.create(function(e){var t=e.color,o=e.size;return{dateInfoFooterRowContainer:{position:"absolute",left:0,right:0},footerSummary:{position:"absolute",left:0,right:0},buttonRow:{backgroundColor:t.white,paddingHorizontal:o.baseRow.paddingHorizontal,paddingVertical:o.vertical.small,borderTopWidth:1,borderColor:t.divider},filler:{height:60}}});J.propTypes=z,J.defaultProps=N,r.default=(0,d.connect)(K,Y)((0,b.default)(J))},1737);