__d(function(e,t,r,s){Object.defineProperty(s,"__esModule",{value:!0});var a=t(765),i=babelHelpers.interopRequireDefault(a),n=t(678),o=babelHelpers.interopRequireDefault(n),u=t(379),l=babelHelpers.interopRequireDefault(u),d=t(412),p=babelHelpers.interopRequireDefault(d),c=t(271),f=(babelHelpers.interopRequireDefault(c),t(790)),b=t(44),I=t(773),R=babelHelpers.interopRequireDefault(I),T=t(410),h=babelHelpers.interopRequireDefault(T),y=t(1057),k=babelHelpers.interopRequireDefault(y),v=t(778),m=babelHelpers.interopRequireDefault(v),H=t(787),F=babelHelpers.interopRequireDefault(H),S=t(422),g=babelHelpers.interopRequireDefault(S),P=t(1352),_=babelHelpers.interopRequireDefault(P),q=t(1788),B=babelHelpers.interopRequireDefault(q),G=t(1850),D=babelHelpers.interopRequireDefault(G),E=t(789),w=babelHelpers.interopRequireDefault(E),j=t(1790),A=t(1797),O=t(1803),x=t(1789),U=t(1770),N=babelHelpers.interopRequireWildcard(U),C={createFeedbacksForTripInstance:p.default.func.isRequired,submitHostFeedback:p.default.func.isRequired,updateFeedbackForGuest:p.default.func.isRequired,loadFeedbackReasons:p.default.func.isRequired,guestProfilesById:p.default.object.isRequired,tripInstancesById:p.default.object.isRequired,tripReservationsById:p.default.object.isRequired,tripTemplatesById:p.default.object.isRequired,isReviewReasonsLoading:p.default.bool.isRequired,reviewReasons:p.default.arrayOf(p.default.object),reportReasons:p.default.arrayOf(p.default.object),currentTripInstanceId:p.default.number,feedbackByGuestProfileId:p.default.object,selectedTripInstanceId:p.default.number.isRequired},W={},M=function(e){var t=(0,O.guestProfilesSelector)(e),r=(0,O.tripInstancesSelector)(e),s=(0,O.tripReservationsSelector)(e),a=(0,O.tripTemplatesSelector)(e),i=(0,O.feedbackSelector)(e),n=i.isReviewReasonsLoading,o=i.feedbackByGuestProfileId,u=i.reportReasons,l=i.reviewReasons;return{currentTripInstanceId:i.tripInstanceId,isReviewReasonsLoading:n,feedbackByGuestProfileId:o,guestProfilesById:t,reportReasons:u,reviewReasons:l,tripInstancesById:r,tripReservationsById:s,tripTemplatesById:a}},L={createFeedbacksForTripInstance:A.createFeedbacksForTripInstance,loadFeedbackReasons:A.loadFeedbackReasons,submitHostFeedback:A.submitHostFeedback,updateFeedbackForGuest:A.updateFeedbackForGuest},V=function(e){function t(r){babelHelpers.classCallCheck(this,t);var s=babelHelpers.possibleConstructorReturn(this,e.call(this,r));return s.submitFeedback=s.submitFeedback.bind(s),s}return babelHelpers.inherits(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.currentTripInstanceId,r=e.selectedTripInstanceId,s=e.reviewReasons,a=e.reportReasons,i=e.isReviewReasonsLoading;r!==t&&this.props.createFeedbacksForTripInstance({tripInstanceId:r}),s||a||i||this.props.loadFeedbackReasons({tripInstanceId:r})},t.prototype.getTripInstance=function(){var e=this.props,t=e.currentTripInstanceId,r=e.tripInstancesById,s=e.tripReservationsById,a=e.tripTemplatesById;if(!t)return null;var i=r[t],n=a[i.associatedTripTemplateId],o=i.associatedTripReservationIds.map(function(e){return s[e]});return babelHelpers.extends({},i,{associatedTripReservations:o,associatedTripTemplate:n})},t.prototype.getReasonsString=function(e){var t=this.props,r=t.reviewReasons,s=t.reportReasons,a=(0,o.default)(r,"id"),i=(0,o.default)(s,"id"),n=e.reviewReasonIds,u=e.reportReasonIds,l=[],d=[];return n&&a&&(l=n.map(function(e){return a[e].name})),u&&i&&(d=u.map(function(e){return i[e].name})),l.concat(d).join(", ")},t.prototype.renderGuestRow=function(e){var t=this,r=this.props.feedbackByGuestProfileId,s=e.guestProfileId,a=r[s],i=x.NO_THUMBS_STATE,n=null,o=null;return a&&(n=a.details,i=a.feedbackType,o=this.getReasonsString(a)),babelHelpers.jsx(D.default,{name:e.firstName,image:e.profilePictureUrl,thumbState:i,details:n,reasons:o,onThumbDownPress:function(){t.props.updateFeedbackForGuest({guestProfileId:s,feedbackType:x.THUMBS_DOWN_STATE}),h.default.present(N.REVIEW_GUEST_PICK_REASONS,{selectedGuestProfileId:s})},onThumbUpPress:function(){return t.props.updateFeedbackForGuest({guestProfileId:s,feedbackType:x.THUMBS_UP_STATE,reviewReasonIds:[],reportReasonIds:[],details:null})},onEditLinkPress:function(){return h.default.present(N.REVIEW_GUEST_PICK_REASONS,{selectedGuestProfileId:s})}},s)},t.prototype.getGuestsWhoAttended=function(){var e=this.props,t=e.guestProfilesById,r=e.feedbackByGuestProfileId,s=this.getTripInstance(),a=s.associatedTripReservations;return(0,i.default)(a.map(function(e){return e.guestProfileIds.map(function(e){return t[e]})})).filter(function(e){var t=r[e.guestProfileId];return!t||t.feedbackType!==x.DID_NOT_ATTEND_STATE})},t.prototype.renderGuestSection=function(){var e=this;return babelHelpers.jsx(m.default,{},void 0,this.getGuestsWhoAttended().map(function(t){return e.renderGuestRow(t)}))},t.prototype.submitFeedback=function(){return this.props.submitHostFeedback({feedbackByGuestProfileId:this.props.feedbackByGuestProfileId,tripInstanceId:this.props.selectedTripInstanceId}).then(function(e){return e.success&&h.default.push(N.REVIEW_GUEST_CONFIRMATION),!1})},t.prototype.readyToSubmit=function(){var e=this.props.feedbackByGuestProfileId;return!!this.getGuestsWhoAttended().reduce(function(t,r){var s=e[r.guestProfileId];return t&&s&&s.feedbackType!==x.NO_THUMBS_STATE},!0)},t.prototype.render=function(){var e=this.getTripInstance(),t=babelHelpers.jsx(R.default,{title:l.default.phrase("Would you host these guests again?",null,"page title for host to review all guests in a past trip instance")}),r=babelHelpers.jsx(k.default,{babu:!0,onPress:this.submitFeedback,inactive:!this.readyToSubmit()},void 0,l.default.phrase("Submit",null,"button title to submit the guest reviews and feedback"));return babelHelpers.jsx(b.View,{style:K.container},void 0,babelHelpers.jsx(F.default,{withInsets:[k.default]},void 0,t,!e&&babelHelpers.jsx(B.default,{}),!!e&&this.renderGuestSection()),r,babelHelpers.jsx(w.default,{},void 0,babelHelpers.jsx(_.default,{id:j.SUBMIT_HOST_FEEDBACK_FAILED_TOAST,description:l.default.phrase("Submission failed. Could not send feedback to server.",null,"Failure message for host feedback flow"),action:l.default.phrase("Try again",null,"link title for click to retry"),onActionPress:this.submitFeedback})))},t}(c.Component);V.propTypes=C,V.defaultProps=W;var K=g.default.create(function(){return{container:{flex:1}}});s.default=(0,f.connect)(M,L)(V)},1849);