__d(function(e,t,n,r){function u(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=t(729),s=u(a),c=t(730),f=t(735),h=u(f),d=t(736),l=u(d),v=t(737),y=u(v),m="GET",k="POST",g="PUT",p="PATCH",b="DELETE",q={},H=new Map,w="",T="monorail",P="",j={},A=function(){},O=function(e,t){return t()},R={},_=!1,E=0,K=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,e);var r=n.apiKey,u=n.host,i=n.unauthorized,a=n.instrument,s=n.oauthToken,c=n.headers;this.resourceName=t,c&&(this.headers=c),u&&(this.host=u),r&&(this.apiKey=r),s&&(this.oauthToken=s),i&&(this.unauthorized=i),a&&(this.instrument=a)}return i(e,null,[{key:"configure",value:function(){function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.apiKey,r=t.hosts,u=t.host,o=t.unauthorized,i=t.instrument,a=t.oauthToken,s=t.headers;return n&&(w=n),u&&(T=u),o&&(A=o),i&&(O=i),a&&(P=a),s&&(j=s),r&&e.configureHosts(r),{hosts:q,defaultApiKey:w,defaultHost:T,defaultUnauthorized:A,defaultInstrument:O,defaultOauthToken:P,defaultHeaders:j}}return t}()},{key:"configureHosts",value:function(){function e(e){Object.keys(e).forEach(function(t){var n=e[t];"string"==typeof n&&(n={url:n}),q[t]=babelHelpers.extends({internal:!0},n)})}return e}()},{key:"cancel",value:function(){function e(e,t){if(!H.has(e))throw new Error("Attempted to cancel unknown request.");var n=H.get(e);n&&n(t)}return e}()},{key:"batch",value:function(){function t(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new e("batch",n),u=new l.default;E+=1;var o=E;R[o]=u,_=!0,t(),_=!1;var i=r.batch(u.operations);return i.then(function(e){u.resolve(e),delete R[o]}).catch(function(e){u.reject(e),delete R[o]}),i}return t}()}]),i(e,[{key:"setHeaders",value:function(){function e(e){this.headers=e}return e}()},{key:"getBaseUrl",value:function(){function e(){var e=this.getHost(),t=q[e];return t?t.url:e}return e}()},{key:"getHost",value:function(){function e(){return this.host||T}return e}()},{key:"getApiKey",value:function(){function e(){return this.apiKey||w}return e}()},{key:"getUnauthorized",value:function(){function e(){return this.unauthorized||A}return e}()},{key:"getInstrument",value:function(){function e(){return this.instrument||O}return e}()},{key:"getOauthToken",value:function(){function e(){return this.oauthToken||P}return e}()},{key:"getHeaders",value:function(){function e(){return this.headers||j}return e}()},{key:"performRequest",value:function(){function e(e){var t=this,n=e.method,r=e.id,u=e.query,o=void 0===u?{}:u,i=e.data,a=void 0===i?{}:i,s=e.headers,f=void 0===s?{}:s,d=this.buildUrl(n,r),l=this.buildQueryParams(o);if(_)return new Promise(function(e,t){R[E].collect({method:n,path:d,body:a,query:l},e,t)});var v=void 0,k=new Promise(function(e,u){function o(e){e&&e.cancelled||u(e)}v=u;var i=function(){function e(e){return function(t){if(H.delete(k),e)throw t;return t}}return e}();t.getInstrument()({host:t.getHost(),resource:t.resourceName,id:r,method:n},function(){var r=(0,c.stringify)(l,{encodeValuesOnly:!0,arrayFormat:"brackets"}),u=a;(0,y.default)(u)||(u=JSON.stringify(u),f.Accept="application/json",f["Content-Type"]="application/json");var s=fetch(String(d)+"?"+String(r),{method:n,body:n===m?null:u,credentials:"include",headers:t.buildHeaders(f)}).then(function(e){return e.json().then(function(t){return{json:t,res:e}})}).catch(function(e){throw new h.default({error_message:e.message,error_code:502})});return s.then(function(e){var n=e.json,r=e.res;return 401===r.status&&t.getUnauthorized()(r),r.ok?n:Promise.reject(new h.default(n))}).then(i(),i(!0)).then(e,o),s})});return H.set(k,function(e){var t=e||new Error("API Request Cancelled");t.cancelled=!0,v(t)}),k}return e}()},{key:"buildQueryParams",value:function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};return this.getApiKey()&&!_&&(t.key=this.getApiKey()),babelHelpers.extends({},t,e)}return e}()},{key:"buildHeaders",value:function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=q[this.getHost()],n=babelHelpers.extends({},this.getHeaders(),e);if(t&&!t.internal)return n;var r=(0,s.default)("_csrf_token");r&&(n["X-CSRF-Token"]=r);var u=this.getOauthToken();return u&&(n["X-Airbnb-OAuth-Token"]=u),n}return e}()},{key:"buildUrl",value:function(){function e(e,t){return String(_?"":this.getBaseUrl())+"/"+String(this.resourceName)+(t?"/"+String(t):"")}return e}()},{key:"member",value:function(){function e(e,t,n,r){return this.performRequest({id:e,query:t,data:n,headers:r,method:m})}return e}()},{key:"collection",value:function(){function e(e,t,n){return this.performRequest({query:e,data:t,headers:n,method:m})}return e}()},{key:"create",value:function(){function e(e,t,n){return this.performRequest({query:e,data:t,headers:n,method:k})}return e}()},{key:"update",value:function(){function e(e,t,n,r){return this.performRequest({id:e,query:t,data:n,headers:r,method:g})}return e}()},{key:"patch",value:function(){function e(e,t,n,r){return this.performRequest({id:e,query:t,data:n,headers:r,method:p})}return e}()},{key:"delete",value:function(){function e(e,t,n,r){return this.performRequest({id:e,query:t,data:n,headers:r,method:b})}return e}()},{key:"batch",value:function(){function e(e,t){return this.performRequest({data:{operations:e},headers:t,method:k})}return e}()}]),e}();r.default=K},728);