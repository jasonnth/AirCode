__d(function(e,t,a,i){function l(e,t,a){var i=e.latitude,l=e.longitude,r=t.latitudeDelta/(0,y.getWindowHeight)(),o=t.longitudeDelta/(0,y.getWindowWidth)(),n=t.latitudeDelta/2,s=t.longitudeDelta/2;return i<t.latitude+n-a.top*r&&i>t.latitude-n+a.bottom*r&&l<t.longitude+s-a.right*o&&l>t.longitude-s+a.left*o}Object.defineProperty(i,"__esModule",{value:!0});var r=t(412),o=babelHelpers.interopRequireDefault(r),n=t(271),s=babelHelpers.interopRequireDefault(n),d=t(44),u=t(654),p=t(790),c=t(410),h=babelHelpers.interopRequireDefault(c),g=t(1646),f=babelHelpers.interopRequireDefault(g),b=t(1023),M=t(420),m=babelHelpers.interopRequireDefault(M),y=t(840),C=t(2067),P=babelHelpers.interopRequireDefault(C),R=t(2068),S=babelHelpers.interopRequireDefault(R),k=t(2069),v=babelHelpers.interopRequireDefault(k),H=t(927),I=babelHelpers.interopRequireDefault(H),w=t(2071),x=babelHelpers.interopRequireDefault(w),q=t(2072),D=babelHelpers.interopRequireDefault(q),V=t(2074),T=t(2054),L=babelHelpers.interopRequireDefault(T),W=t(2075),_=babelHelpers.interopRequireDefault(W),E=t(2035),j=babelHelpers.interopRequireWildcard(E),O=t(1920),B=babelHelpers.interopRequireWildcard(O),F=t(2057),A=babelHelpers.interopRequireDefault(F),G=0,U=function(e){return e.location},z=function(e){return e.coordinate},Y=function(e){return function(t){t.stopPropagation(),e(t)}},J=Y(function(){}),K={guidebookPlaces:o.default.array,reservations:o.default.array,selectedMapMarkerPlaceId:o.default.any,title:o.default.string,guidebookId:o.default.number,pressedCloseGuidebookScreen:o.default.func.isRequired,highlightPlaceOnMap:o.default.func.isRequired,mapMarkerSelected:o.default.func.isRequired,fetchLoggedInUserReservations:o.default.func.isRequired,searchContextString:o.default.string},N=function(e){function t(a,i){babelHelpers.classCallCheck(this,t);var l=babelHelpers.possibleConstructorReturn(this,e.call(this,a,i));l.setScrollView=l.setScrollView.bind(l),l.setMap=l.setMap.bind(l),l.handleScroll=l.handleScroll.bind(l),l.handleCardFocus=l.handleCardFocus.bind(l),l.handleMapRegionChanged=l.handleMapRegionChanged.bind(l),l.handleMapPress=l.handleMapPress.bind(l),l.toggleCarousel=l.toggleCarousel.bind(l),l.getEdgePadding=l.getEdgePadding.bind(l),l.fitMap=l.fitMap.bind(l),l.handleLayoutMap=l.handleLayoutMap.bind(l);var r=a.guidebookPlaces.map(U);return l.state={carouselBottom:new d.Animated.Value(G),hideCarousel:!1,initialRegion:(0,V.calcMapInitialRegion)(r),region:null},l.mapRegion=l.state.initialRegion,l.lastSelectedMarkerId=null,l}return babelHelpers.inherits(t,e),t.prototype.handleLayoutMap=function(){if(!this.didHandleLayoutMap){this.didHandleLayoutMap=!0,this.fitMap();var e=this.props,t=e.guidebookPlaces,a=e.selectedMapMarkerPlaceId;a?this.scrollToPlaceId(a,!1):t&&t.length>0&&this.handleCardFocus(t[0],!1)}},t.prototype.getEdgePadding=function(){return{top:70,bottom:this.carouselHeight?Math.ceil(this.carouselHeight)+30:200,left:50,right:50}},t.prototype.fitMap=function(){if(this.map){var e=this.props.guidebookPlaces.map(z);this.map.fitToCoordinates(e,{edgePadding:this.getEdgePadding(),animated:!0})}},t.prototype.componentWillMount=function(){(0,this.props.fetchLoggedInUserReservations)()},t.prototype.scrollToPlaceId=function(e,t){var a=this.props.guidebookPlaces.findIndex(function(t){return t.primary_place.id===e});a<0||this.scrollView.scrollTo({x:a*this.mapCardTotalWidth,animated:t})},t.prototype.setMap=function(e){this.map=e},t.prototype.setScrollView=function(e){this.scrollView=e},t.prototype.handleMapRegionChanged=function(e){this.setState({region:e}),this.mapRegion=e},t.prototype.handleCardFocus=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this.props.highlightPlaceOnMap;t&&!l(e.coordinate,this.mapRegion,this.getEdgePadding())&&this.fitMap(),a(null,e),this.lastSelectedMarkerId=e.primary_place.id},t.prototype.handleScroll=function(e){var t=this.props,a=t.guidebookPlaces,i=t.selectedMapMarkerPlaceId,l=e.nativeEvent.contentOffset.x,r=l+.75*this.mapCardTotalWidth,o=r<0?0:Math.min(Math.floor(r/this.mapCardTotalWidth),a.length-1),n=a[o];n.primary_place.id!==i&&this.handleCardFocus(n)},t.prototype.toggleCarousel=function(e){var t=this.state,a=t.carouselBottom;t.hideCarousel===e&&(this.setState({hideCarousel:!e}),d.Animated.timing(a,{toValue:e?G:1,duration:250}).start())},t.prototype.handleMapPress=function(){var e=this.state.hideCarousel;this.props.mapMarkerSelected(e?this.lastSelectedMarkerId:null),this.toggleCarousel(e)},t.prototype.render=function(){var e=this,t=this.props,a=t.guidebookId,i=t.guidebookPlaces,l=t.reservations,r=t.selectedMapMarkerPlaceId,o=t.title,n=t.mapMarkerSelected,u=t.pressedCloseGuidebookScreen,p=this.state.carouselBottom,c=this.carouselHeight;if(!i)return null;var g=((0,y.getWindowWidth)()-48-11)/2;g=170<g?170:g,this.mapCardTotalWidth=g+11;var b=(0,y.getWindowWidth)()-24-g-11;return babelHelpers.jsx(L.default,{},void 0,babelHelpers.jsx(h.default.Screen,{barType:h.default.Screen.BAR_TYPE.OVERLAY,hideStatusBarUntilFoldOffset:!0}),babelHelpers.jsx(d.View,{style:d.StyleSheet.absoluteFill},void 0,!m.default.isMissingGooglePlayServices()&&s.default.createElement(f.default,{onLayout:this.handleLayoutMap,provider:(0,x.default)(),ref:this.setMap,style:d.StyleSheet.absoluteFill,initialRegion:this.state.initialRegion,onRegionChangeComplete:this.handleMapRegionChanged,onPress:this.handleMapPress,moveOnMarkerPress:!1,onBackPress:u},babelHelpers.jsx(S.default,{mapRegion:this.state.region}),babelHelpers.jsx(P.default,{}),l&&l.map(function(e){return babelHelpers.jsx(v.default,{coordinate:{latitude:e.listing.lat,longitude:e.listing.lng},svg:I.default.SVGS.house,onPress:J},e.listing.id)}),i&&i.map(function(t){var a=t.primary_place.id===r,i=t.primary_place.id;return babelHelpers.jsx(D.default,{coordinate:t.coordinate,onPress:Y(function(){e.lastSelectedMarkerId=i,n(i),e.scrollToPlaceId(i,!1),e.toggleCarousel(!0)}),airmoji:t.airmoji,isSelected:a,placeId:i,style:a?Q.selectedMarker:Q.unselectedMarker},i)})),s.default.createElement(d.Animated.View,{style:[Q.carouselContainer,{bottom:c?p.interpolate({inputRange:[G,1],outputRange:[0,-c]}):0}],ref:function(t){e.carouselView=t},onLayout:function(t){e.carouselHeight=t.nativeEvent.layout.height}},o&&babelHelpers.jsx(d.Text,{style:Q.carouselTitle},void 0,o),s.default.createElement(d.ScrollView,{horizontal:!0,showsHorizontalScrollIndicator:!1,ref:this.setScrollView,style:Q.scrollView,contentContainerStyle:Q.scrollViewContent,scrollEventThrottle:100,onScroll:this.handleScroll},i.map(function(t){return babelHelpers.jsx(_.default,{mapCardMarginRight:11,mapCardWidth:g,isSelected:r===t.primary_place.id,onPressDetails:function(){return h.default.push(B.PLACE,{guidebookId:a,placeId:t.primary_place.id,title:t.primary_place_name,primaryPhoto:(0,A.default)(t),searchContextString:e.props.searchContextString})},place:t},t.primary_place.id)}),babelHelpers.jsx(d.View,{style:{width:b}})))))},t}(n.PureComponent),Q=b.ThemedStyleSheet.create(function(e){var t=e.color,a=e.font,i=e.bp;return{carouselContainer:{position:"absolute",backgroundColor:t.white,left:0,right:0,paddingTop:2*i+2,overflow:"hidden",paddingBottom:13},carouselTitle:babelHelpers.extends({},a.largePlus,{paddingLeft:3*i-1,paddingBottom:2*i+3}),scrollView:{flexDirection:"row"},scrollViewContent:{paddingLeft:24},unselectedMarker:{zIndex:1},selectedMarker:{zIndex:1100}}});N.propTypes=K,i.default=(0,p.connect)(function(e){return{selectedMapMarkerPlaceId:e.guidebook.core.selectedMapMarkerPlaceId,reservations:e.guidebook.core.reservations}},function(e){return(0,u.bindActionCreators)({pressedCloseGuidebookScreen:j.pressedCloseGuidebookScreen,highlightPlaceOnMap:j.highlightPlaceOnMap,mapMarkerSelected:j.mapMarkerSelected,fetchLoggedInUserReservations:j.fetchLoggedInUserReservations},e)})(N)},2066);