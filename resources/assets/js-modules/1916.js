__d(function(e,t,r,i){Object.defineProperty(i,"__esModule",{value:!0});var s=t(790),a=t(654),n=t(412),o=babelHelpers.interopRequireDefault(n),l=t(271),d=(babelHelpers.interopRequireDefault(l),t(44)),p=t(759),u=babelHelpers.interopRequireDefault(p),c=t(379),f=babelHelpers.interopRequireDefault(c),b=t(377),h=babelHelpers.interopRequireDefault(b),g=t(1023),T=t(410),m=babelHelpers.interopRequireDefault(T),R=t(787),C=babelHelpers.interopRequireDefault(R),N=t(1352),v=babelHelpers.interopRequireDefault(N),E=t(781),S=babelHelpers.interopRequireDefault(E),x=t(840),A=t(1870),y=t(1871),D=babelHelpers.interopRequireWildcard(y),H=t(1482),_=babelHelpers.interopRequireWildcard(H),w=t(1917),q=babelHelpers.interopRequireDefault(w),P=t(1910),G=babelHelpers.interopRequireDefault(P),M=t(376),I=babelHelpers.interopRequireDefault(M),U=t(1483),k=t(1919),B=t(1874),j=t(1875),F={code:o.default.string.isRequired,token:o.default.string.isRequired,amount:o.default.number.isRequired,currency:o.default.string.isRequired,videoUrl:o.default.string.isRequired,overlayUrl:o.default.string.isRequired,recipientName:o.default.string.isRequired,senderName:o.default.string.isRequired,recipientMessage:o.default.string.isRequired,redeemGiftCards:o.default.func.isRequired,isFetching:o.default.bool,updateGiftCreditRequestSucceeded:o.default.bool,errorMessage:o.default.string,errorDetails:o.default.string},V={},L=function(e){function t(r){babelHelpers.classCallCheck(this,t);var i=babelHelpers.possibleConstructorReturn(this,e.call(this,r));return i.state={isVideoOnScreen:!1,hasStartedLoading:!1},i.getButtonText=i.getButtonText.bind(i),i.getTitleText=i.getTitleText.bind(i),i.onButtonPress=i.onButtonPress.bind(i),i.onLinkPress=i.onLinkPress.bind(i),i.onNavigationAppear=i.onNavigationAppear.bind(i),i.redeemGiftCredits=i.redeemGiftCredits.bind(i),i.shouldShowToast=i.shouldShowToast.bind(i),i}return babelHelpers.inherits(t,e),t.prototype.redeemGiftCredits=function(){var e=this.props,t=e.code,r=e.token;this.props.redeemGiftCards(t,{code:t,token:r})},t.prototype.onLinkPress=function(){var e=this.props,t=e.code,r=e.errorDetails;r?r===B.GIFT_CREDIT_CLAIMED?(0,j.logGiftingFlowClickViewGiftBalanceAlreadyRedeemedEvent)(t):(0,j.logGiftingFlowClickViewGiftBalanceOtherErrorStatesEvent)(t):(0,j.logGiftingFlowClickViewGiftBalanceSuccessfulRedemptionEvent)(t),I.default.user()&&m.default.present(_.AUTHENTICATED_WEBVIEW,{url:(0,U.getWebUrl)("/users/payment_methods/"+I.default.user().id)})},t.prototype.getButtonText=function(){return this.props.errorDetails===B.UNSUPPORTED_PAYMENT_INSTRUMENT||this.props.errorDetails===B.NO_PAYMENT_INSTRUMENT?f.default.phrase("Add %{amount} to account",{amount:h.default.priceString(this.props.amount,this.props.currency)},"CTA to add %{amount} of gift credit to account"):f.default.phrase("Explore Airbnb",null,"CTA to explore Airbnb app")},t.prototype.getTitleText=function(){return this.props.errorDetails?null:f.default.phrase("%{amount} has been added to your gift card account",{amount:h.default.priceString(this.props.amount,this.props.currency)},"title to show you how much gift credit you received")},t.prototype.onButtonPress=function(){var e=this.props,t=e.code,r=e.errorDetails;r===B.UNSUPPORTED_PAYMENT_INSTRUMENT||r===B.NO_PAYMENT_INSTRUMENT?((0,j.logGiftingFlowClickAddGiftEvent)(t),m.default.present(_.ADD_PAYMENT_INSTRUMENTS,{add_payment_method_client:B.ADD_PAYMENT_METHOD_GIFTCARD_CLIENT})):(r?r===B.GIFT_CREDIT_CLAIMED?(0,j.logGiftingFlowClickExploreAirbnbAlreadyRedeemedEvent)(t):(0,j.logGiftingFlowClickExploreAirbnbOtherErrorStatesEvent)(t):(0,j.logGiftingFlowClickExploreAirbnbSuccessfulRedemptionEvent)(t),(0,k.navigateToExplore)("all_tab"))},t.prototype.onNavigationAppear=function(){this.setState({isVideoOnScreen:!0,hasStartedLoading:!0}),this.props.isFetching||this.redeemGiftCredits()},t.prototype.shouldShowToast=function(){return this.state.hasStartedLoading&&this.props.errorMessage&&this.props.errorDetails!==B.NO_PAYMENT_INSTRUMENT},t.prototype.render=function(){var e=this,t=(0,x.getWindowHeight)(),r=(0,x.getWindowWidth)();return babelHelpers.jsx(d.View,{style:O.container},void 0,babelHelpers.jsx(C.default,{withInsets:[q.default]},void 0,!this.props.errorDetails&&this.props.updateGiftCreditRequestSucceeded&&babelHelpers.jsx(d.View,{style:O.giftTitleContainer},void 0,babelHelpers.jsx(d.Text,{style:O.giftTitle},void 0,this.getTitleText())),!!this.props.recipientName&&!!this.props.senderName&&babelHelpers.jsx(d.View,{style:O.giftContainer},void 0,babelHelpers.jsx(G.default,{barType:m.default.Screen.BAR_TYPE.STATIC,scrollEnabled:!1,overlayUrls:[{uri:this.props.overlayUrl}],videoUrl:this.props.videoUrl,topText:f.default.phrase("%{recipientName},",{recipientName:this.props.recipientName.toUpperCase()},"displayed phrase to indicate that this gift card is for %{recipientName}"),bottomText:f.default.phrase("- %{senderName}",{senderName:this.props.senderName.toUpperCase()},"displayed phrase to indicate that this gift card is sent from %{senderName}"),height:3*t/5,width:3*r/5,paused:!this.state.isVideoOnScreen})),!!this.props.recipientMessage&&babelHelpers.jsx(d.View,{style:O.messageContainer},void 0,babelHelpers.jsx(d.Text,{style:O.message},void 0,'"',this.props.recipientMessage,'"'))),babelHelpers.jsx(S.default,{withInsets:[q.default]},void 0,this.shouldShowToast()&&babelHelpers.jsx(v.default,{description:this.props.errorMessage})),(this.getButtonText()||!this.state.hasStartedLoading)&&babelHelpers.jsx(d.View,{style:{width:r}},void 0,babelHelpers.jsx(q.default,{loading:this.props.isFetching||!this.state.hasStartedLoading,text:this.getButtonText(),onPress:this.onButtonPress})),babelHelpers.jsx(m.default.Screen,{barType:m.default.Screen.BAR_TYPE.STATIC,onAppear:this.onNavigationAppear,onDisappear:function(){return e.setState({isVideoOnScreen:!1})},link:f.default.phrase("View gift balance",null,"CTA on navigation bar to launch web view to show gift credit balance"),onLinkPress:this.onLinkPress}))},t}(l.PureComponent);L.propTypes=F,L.defaultProps=V;var O=g.ThemedStyleSheet.create(function(e){var t=e.color,r=e.font,i=e.size;return{container:{flex:1,backgroundColor:t.clear},giftTitleContainer:{flex:1,alignItems:"center"},giftTitle:babelHelpers.extends({},r.title3,{textAlign:"center"}),giftContainer:{alignItems:"center",padding:i.vertical.small},messageContainer:{flex:1,alignItems:"center",padding:i.vertical.small},message:babelHelpers.extends({},r.large,{textAlign:"center"})}});i.default=(0,s.connect)(function(e){return(0,u.default)((0,A.redemptionSelector)(e),["amount","currency","isFetching","updateGiftCreditRequestSucceeded","overlayUrl","recipientMessage","recipientName","senderName","videoUrl","errorDetails","errorMessage"])},function(e){return(0,a.bindActionCreators)({redeemGiftCards:D.redeemGiftCards},e)})(L)},1916);