__d(function(e,t,r,i){Object.defineProperty(i,"__esModule",{value:!0});var o=t(271),s=babelHelpers.interopRequireDefault(o),l=t(834),a=t(44),n=t(790),p=t(782),d=babelHelpers.interopRequireDefault(p),u=t(562),b=babelHelpers.interopRequireDefault(u),c=t(379),f=babelHelpers.interopRequireDefault(c),h=t(1603),m=t(1604),T=t(841),v=babelHelpers.interopRequireDefault(T),H=t(410),g=babelHelpers.interopRequireDefault(H),R=t(1411),w=babelHelpers.interopRequireDefault(R),y=t(787),x=babelHelpers.interopRequireDefault(y),S=t(1023),I=t(1583),D=babelHelpers.interopRequireDefault(I),_=t(899),P=babelHelpers.interopRequireDefault(_),q=t(420),j=babelHelpers.interopRequireDefault(q),C=t(1348),U=babelHelpers.interopRequireDefault(C),A=t(1352),B=babelHelpers.interopRequireDefault(A),k=t(839),E=babelHelpers.interopRequireDefault(k),O=t(1605),F=t(789),L=babelHelpers.interopRequireDefault(F),V=t(1585),W=t(1606),Y=babelHelpers.interopRequireDefault(W),M=t(1639),N=babelHelpers.interopRequireDefault(M),z=t(1643),G=babelHelpers.interopRequireDefault(z),J=t(1659),K=babelHelpers.interopRequireDefault(J),Q=t(1669),X=babelHelpers.interopRequireDefault(Q),Z=t(1670),$=babelHelpers.interopRequireDefault(Z),ee=t(1678),te=babelHelpers.interopRequireDefault(ee),re=t(1679),ie=babelHelpers.interopRequireDefault(re),oe=t(1693),se=babelHelpers.interopRequireDefault(oe),le=t(1700),ae=babelHelpers.interopRequireDefault(le),ne=t(1704),pe=babelHelpers.interopRequireDefault(ne),de=t(1705),ue=babelHelpers.interopRequireDefault(de),be=t(1706),ce=babelHelpers.interopRequireDefault(be),fe=t(1709),he=t(1657),me=t(1482),Te=babelHelpers.interopRequireWildcard(me),ve=t(1573),He=babelHelpers.interopRequireWildcard(ve),ge=t(1685),Re=t(1710),we=t(1609),ye=t(1711),xe=t(1661),Se=t(1575),Ie=t(1578),De=t(1668),_e=babelHelpers.interopRequireDefault(De),Pe=t(1634),qe=babelHelpers.interopRequireDefault(Pe),je={currentTab:l.Types.number,feedbacks:l.Types.array,isFetchingReviews:l.Types.bool,isPreview:l.Types.bool,mtPdpReferrer:l.Types.number,mtPdpReferrerId:l.Types.number,otherExperience:(0,l.Shape)({title:l.Types.string.isRequired,tripTemplates:l.Types.arrayOf(qe.default)}),posterImageURL:l.Types.string,reviews:l.Types.arrayOf(_e.default),scheduledTripTemplates:l.Types.array,tripTemplate:l.Types.object,tripTemplateId:l.Types.number.isRequired,notWaitlisted:l.Types.bool,searchContextString:l.Types.string,searchStartDate:l.Types.string,searchEndDate:l.Types.string,soundOn:l.Types.bool.isRequired,dispatch:l.Types.func.isRequired,setTimeout:l.Types.func.isRequired,onIsInteractive:l.Types.func.isRequired},Ce={currentTab:h.ExploreSubtab.Unknown,feedbacks:[],isFetchingReviews:!1,isPreview:!1,mtPdpReferrer:m.MtPdpReferrer.Unknown,mtPdpReferrerId:0,otherExperience:{title:"",tripTemplates:[]},posterImageURL:null,reviews:[],searchContextString:null,searchStartDate:null,searchEndDate:null,scheduledTripTemplates:[],tripTemplate:null,notWaitlisted:null},Ue=function(e,t){return{feedbacks:(0,Ie.feedbacksSelector)(e,t.tripTemplateId),isFetchingReviews:(0,Ie.rootSelector)(e).get("isFetchingReviews"),otherExperience:(0,Ie.otherExperienceSelector)(e,t.tripTemplateId),reviews:(0,Ie.reviewsSelector)(e,t.tripTemplateId),scheduledTripTemplates:(0,Ie.scheduledTripTemplatesSelector)(e,t.tripTemplateId),soundOn:(0,Ie.rootSelector)(e).get("soundOn"),tripTemplate:(0,Ie.rootSelector)(e).get("tripTemplatesById").get(t.tripTemplateId),notWaitlisted:(0,Ie.rootSelector)(e).get("showWaitlistsByTripTemplateId").get(t.tripTemplateId)}},Ae=function(e){return{dispatch:e}},Be=(0,O.memoize)(function(e,t){return e?(e.carousel_collection_multimedia||[]).map(function(e){return e.video&&e.video.is_video_ready?{videoId:e.video.id,videoUri:(0,fe.selectPlatformVideoUri)(e.video,t)}:null}).filter(Boolean)[0]:null}),ke=function(e){function t(r,i){babelHelpers.classCallCheck(this,t);var o=babelHelpers.possibleConstructorReturn(this,e.call(this,r,i));return o.state={buttonRowBottom:new a.Animated.Value(0),transitionCompleted:!1,coverFocused:!0,shouldRenderBody:!1,showAboutHostOnTop:(0,Re.inHighlightAboutHostSection)()},o.onScroll=o.onScroll.bind(o),o.visitUserProfile=o.visitUserProfile.bind(o),o.prevOffset=0,o.buttonRowVisible=!1,o.buttonRowFinishedAnimatingIn=!1,o.props.setTimeout(function(){return o.setState({shouldRenderBody:!0})},500),o}return babelHelpers.inherits(t,e),t.prototype.componentWillMount=function(){var e=this;this.setState({networkInfo:j.default.networkInfo()}),this.props.setTimeout(function(){return e.setState({transitionCompleted:!0})},4e3)},t.prototype.componentDidMount=function(){this.loadTemplateAndUser(),(0,we.logPDPImpressionEvent)(this.props)},t.prototype.componentDidUpdate=function(e){var t=this.props.tripTemplate,r=e.tripTemplate;!e.tripTemplate&&this.props.tripTemplate&&this.props.onIsInteractive(),r!==t&&this.loadOtherExperiences(t)},t.prototype.visitUserProfile=function(){var e=this.props.tripTemplate,t=e.experiences[0],r=t.experience_host_profile.host.id;(0,we.logPDPClickHost)(r,e),g.default.push(Te.USER_PROFILE,{user_id:r,hide_reviews:!0})},t.prototype.loadTemplateAndUser=function(){var e=this.props,t=e.tripTemplateId,r=e.dispatch,i=[He.loadFeedbacks({template_id:t}),He.loadReviews(t),He.loadTripTemplate(t)];null===this.props.notWaitlisted&&i.push(He.loadWaitlists({template_id:t}));var o=(0,b.default)(),s=(0,b.default)(o).add("8","months"),l={starts_after:o.format("YYYY-MM-DD"),starts_before:s.format("YYYY-MM-DD"),template_id:t,guest_count:1};i.push(He.loadScheduledTripTemplates(l)),i.push(He.loadUser("me")),r(i)},t.prototype.loadOtherExperiences=function(e){var t=e.id,r=e.market.name,i=this.props,o=i.dispatch,s=i.searchStartDate,l=i.searchEndDate,a=s&&l?{checkin:s,checkout:l}:{},n=babelHelpers.extends({location:r},a);o(He.loadOtherExperiences(t,n))},t.prototype.slideUpButtonRow=function(){var e=this;this.buttonRowVisible||(a.Animated.timing(this.state.buttonRowBottom,{toValue:-N.default.contentInset.bottom,duration:250}).start(function(t){var r=t.finished;e.buttonRowFinishedAnimatingIn=r}),this.buttonRowVisible=!0)},t.prototype.slideDownButtonRow=function(){this.buttonRowVisible&&(a.Animated.timing(this.state.buttonRowBottom,{toValue:0,duration:250}).start(),this.buttonRowVisible=!1,this.buttonRowFinishedAnimatingIn=!1)},t.prototype.forceSlideUpButtonRowIfNecessary=function(e){this.contentHeight&&e>this.contentHeight-(0,he.getWindowDimension)().height-200&&2*e>this.contentHeight&&!this.buttonRowFinishedAnimatingIn&&(this.setState({buttonRowBottom:new a.Animated.Value(-N.default.contentInset.bottom)}),this.buttonRowFinishedAnimatingIn=!0)},t.prototype.onScroll=function(e){var t=e.nativeEvent.contentOffset.y;this.forceSlideUpButtonRowIfNecessary(t);var r=t>this.prevOffset;r&&t>300&&this.slideUpButtonRow(),!r&&t<500&&this.slideDownButtonRow(),this.state.coverFocused&&t>300&&this.setState({coverFocused:!1}),!this.state.coverFocused&&t<=300&&this.setState({coverFocused:!0}),this.prevOffset=t},t.prototype.renderWaitlistSaveSuccessToast=function(){var e=this.props.tripTemplate,t=e.experience_host_profile.host.first_name;return babelHelpers.jsx(L.default,{},void 0,babelHelpers.jsx(B.default,{id:Se.SAVE_WAITLIST_SUCCESS_PDP_TOAST,title:f.default.phrase("Great!",null,"congratulations title"),description:f.default.phrase("You\u2019ll be notified once %{hostName} adds more dates.",{hostName:t},"notification message")},Se.SAVE_WAITLIST_SUCCESS_PDP_TOAST))},t.prototype.renderPortrait=function(){var e=this,t=this.props,r=t.tripTemplate,i=t.tripTemplateId,o=t.notWaitlisted,s=t.isPreview,l=t.scheduledTripTemplates,n=t.soundOn,p=t.posterImageURL,d=Be(r,this.state.networkInfo);return babelHelpers.jsx(a.View,{style:Ee.container},void 0,babelHelpers.jsx(g.default.Screen,{onEnterTransitionComplete:function(){return e.setState({transitionCompleted:!0})},hideStatusBarUntilFoldOffset:!0}),babelHelpers.jsx(x.default,{onScroll:this.onScroll,scrollEventThrottle:200,withInsets:[N.default]},void 0,babelHelpers.jsx(a.View,{style:Ee.mainContent,removeClippedSubviews:!0,onLayout:function(t){var r=t.nativeEvent;e.contentHeight=r.layout.height}},void 0,babelHelpers.jsx($.default,{prefetchedUri:this.props.posterImageURL,photos:(0,ye.getCoverPictures)(r,p),tripTemplate:r,tripTemplateId:i,coverFocused:this.state.coverFocused,videoUri:d?d.videoUri:null,videoId:d?d.videoId:0,soundOn:n}),babelHelpers.jsx(U.default,{type:"tripTemplate",typeId:i,subType:"body",subTypeId:0},void 0,this.renderBody()))),r&&this.state.transitionCompleted&&babelHelpers.jsx(a.Animated.View,{style:[Ee.buttonContainer,{transform:[{translateY:this.state.buttonRowBottom}]}]},void 0,babelHelpers.jsx(N.default,{tripTemplate:r,isPreview:s,notWaitlisted:o,isSoldOut:0===l.length})),r&&this.renderWaitlistSaveSuccessToast())},t.prototype.renderTabletLandscape=function(){var e=this.props,t=e.tripTemplate,r=e.tripTemplateId,i=e.notWaitlisted,o=e.isPreview,s=e.scheduledTripTemplates,l=e.soundOn,n=e.posterImageURL,p=Be(t,this.state.networkInfo);return babelHelpers.jsx(a.View,{style:Ee.containerTabletLandscape},void 0,babelHelpers.jsx(g.default.Screen,{barType:g.default.Screen.BAR_TYPE.SPECIALTY,hideStatusBarUntilFoldOffset:!0}),babelHelpers.jsx(a.View,{style:Ee.wrapper},void 0,babelHelpers.jsx(x.default,{},void 0,this.renderBody()),t&&babelHelpers.jsx(a.View,{style:[Ee.buttonContainer,Ee.buttonContainerLandscape]},void 0,babelHelpers.jsx(N.default,{tripTemplate:t,isPreview:o,notWaitlisted:i,isSoldOut:0===s.length})),t&&this.renderWaitlistSaveSuccessToast()),babelHelpers.jsx(a.View,{},void 0,babelHelpers.jsx($.default,{prefetchedUri:this.props.posterImageURL,photos:(0,ye.getCoverPictures)(t,n),tripTemplateId:r,tripTemplate:t,coverFocused:this.state.coverFocused,videoUri:p?p.videoUri:null,videoId:p?p.videoId:0,soundOn:l})))},t.prototype.renderBody=function(){var e=this.props,t=e.feedbacks,r=e.isFetchingReviews,i=e.otherExperience,o=i.title,s=i.tripTemplates,l=e.scheduledTripTemplates,n=e.reviews,p=e.tripTemplate,d=e.tripTemplateId,u=this.state,b=u.shouldRenderBody,c=u.showAboutHostOnTop;if(!b||!p)return babelHelpers.jsx(a.View,{style:Ee.bodyLoaderContainer},void 0,babelHelpers.jsx(v.default,{}));var h=0===l.length,m=p.experiences[0],T=m.duration_hours,H=m.experience_host_profile.host,g=H.first_name,R=H.profile_pic_path,y=f.default.phrase("%{smart_count} hour experience |||| %{smart_count} hour experience",{smart_count:T},"the duration of the experience"),x=(0,ge.productHostRowTitle)(p),S=x||y;return babelHelpers.jsx(a.View,{removeClippedSubviews:!0},void 0,babelHelpers.jsx(ue.default,{asMarquee:j.default.isTablet&&j.default.isLandscape(),tripTemplate:p}),babelHelpers.jsx(w.default,{divider:"none",imageUrl:R,onPressImage:this.visitUserProfile,title:S,subtitle:babelHelpers.jsx(P.default,{default:"Hosted by %{link_start}%{firstName}%{link_end}",link:babelHelpers.jsx(a.Text,{style:Ee.link,onPress:this.visitUserProfile}),firstName:g,context:"Experience host info"})}),babelHelpers.jsx(ie.default,{tripTemplate:p,showAboutHost:c}),babelHelpers.jsx(G.default,{experiences:p.experiences,tripTemplate:p}),babelHelpers.jsx(Y.default,{tripTemplate:p}),!c&&babelHelpers.jsx(X.default,{tripTemplate:p,isSingleExperience:!0}),!h&&babelHelpers.jsx(se.default,{isPreview:!1,tripTemplate:p,scheduledTripTemplates:l}),babelHelpers.jsx(ae.default,{isFetching:r,reviews:n,tripTemplate:p}),t&&t.length>0&&(0,xe.extractPhotosFromReviews)(t).length>0&&babelHelpers.jsx(K.default,{reviews:t,tripTemplateId:d}),babelHelpers.jsx(te.default,{tripTemplate:p}),babelHelpers.jsx(pe.default,{tripTemplate:p}),s.length>0&&babelHelpers.jsx(ce.default,{similarTripTemplates:s,title:o}))},t.prototype.render=function(){var e=this;return babelHelpers.jsx(D.default,{renderPortrait:function(){return e.renderPortrait()},renderLandscape:function(){return e.renderTabletLandscape()}})},t}(s.default.Component),Ee=S.ThemedStyleSheet.create(function(e){var t=e.font,r=e.color,i=e.bp,o=e.size;return{bodyLoaderContainer:{paddingTop:4*i,paddingBottom:8*i,backgroundColor:r.white},buttonContainer:babelHelpers.extends({position:"absolute",bottom:-N.default.contentInset.bottom-2,left:-1,right:-1},E.default.footer,{paddingLeft:1,paddingRight:1}),buttonContainerLandscape:{bottom:0},container:{flex:1,backgroundColor:r.white},containerTabletLandscape:{flex:1,flexDirection:"row",backgroundColor:r.white,marginTop:V.TABLET_LANDSCAPE_PADDING_TOP},coverImage:{backgroundColor:r.coverImageBackground},loadingContainer:{alignItems:"center",marginTop:o.vertical.huge},title:t.title2,seeAllAvailable:babelHelpers.extends({},t.largeActionable,{marginVertical:1*i}),subtitle:babelHelpers.extends({},t.regular,{paddingTop:i,paddingBottom:o.vertical.small}),soldOutText:babelHelpers.extends({},t.large,{color:r.textLink,marginVertical:o.vertical.tiny}),wrapper:{flex:1,backgroundColor:r.white,paddingBottom:N.default.contentInset.bottom,marginBottom:-3},link:t.regularActionable,mainContent:{marginBottom:-3}}});ke.propTypes=je,ke.defaultProps=Ce,i.default=(0,n.connect)(Ue,Ae)((0,d.default)(ke))},1602);